<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="MCP server, command line utility, and library for Ruby SimpleCov test coverage analysis"><link href=https://keithrbennett.github.io/cov-loupe/user/LIBRARY_API/ rel=canonical><link href=../MCP_INTEGRATION/ rel=prev><link href=../ADVANCED_USAGE/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>Library API - CovLoupe Documentation</title><link rel=stylesheet href=../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/stylesheets/branding.css><link rel=stylesheet href=../../assets/stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#library-api-guide class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="CovLoupe Documentation" class="md-header__button md-logo" aria-label="CovLoupe Documentation" data-md-component=logo> <img src=../../assets/images/cov-loupe-logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> CovLoupe Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Library API </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/keithrbennett/cov-loupe title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> keithrbennett/cov-loupe </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../INSTALLATION/ class=md-tabs__link> Getting Started </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../ class=md-tabs__link> User Guide </a> </li> <li class=md-tabs__item> <a href=../migrations/ class=md-tabs__link> Migrations </a> </li> <li class=md-tabs__item> <a href=../prompts/ class=md-tabs__link> Prompt Library </a> </li> <li class=md-tabs__item> <a href=../../dev/ class=md-tabs__link> Developer Guide </a> </li> <li class=md-tabs__item> <a href=../../contributing/ class=md-tabs__link> Contributing </a> </li> <li class=md-tabs__item> <a href=../../code_of_conduct/ class=md-tabs__link> Code of Conduct </a> </li> <li class=md-tabs__item> <a href=../../release_notes/ class=md-tabs__link> Release Notes </a> </li> <li class=md-tabs__item> <a href=../../license/ class=md-tabs__link> License </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="CovLoupe Documentation" class="md-nav__button md-logo" aria-label="CovLoupe Documentation" data-md-component=logo> <img src=../../assets/images/cov-loupe-logo.png alt=logo> </a> CovLoupe Documentation </label> <div class=md-nav__source> <a href=https://github.com/keithrbennett/cov-loupe title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> keithrbennett/cov-loupe </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../INSTALLATION/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=../../QUICKSTART/ class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> <li class=md-nav__item> <a href=../EXAMPLES/ class=md-nav__link> <span class=md-ellipsis> Examples </span> </a> </li> <li class=md-nav__item> <a href=../../examples/mcp-inputs/ class=md-nav__link> <span class=md-ellipsis> MCP Input Examples </span> </a> </li> <li class=md-nav__item> <a href=../../examples/success_predicates/ class=md-nav__link> <span class=md-ellipsis> Success Predicate Examples </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> User Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> User Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../CLI_USAGE/ class=md-nav__link> <span class=md-ellipsis> CLI Usage </span> </a> </li> <li class=md-nav__item> <a href=../MCP_INTEGRATION/ class=md-nav__link> <span class=md-ellipsis> MCP Integration </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Library API </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Library API </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#table-of-contents class=md-nav__link> <span class=md-ellipsis> Table of Contents </span> </a> </li> <li class=md-nav__item> <a href=#quick-start class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> <li class=md-nav__item> <a href=#method-reference class=md-nav__link> <span class=md-ellipsis> Method Reference </span> </a> <nav class=md-nav aria-label="Method Reference"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#listsort_order-descending-raise_on_stale-nil-tracked_globs class=md-nav__link> <span class=md-ellipsis> list(sort_order: :descending, raise_on_stale: nil, tracked_globs: []) </span> </a> </li> <li class=md-nav__item> <a href=#summary_forpath class=md-nav__link> <span class=md-ellipsis> summary_for(path) </span> </a> </li> <li class=md-nav__item> <a href=#uncovered_forpath class=md-nav__link> <span class=md-ellipsis> uncovered_for(path) </span> </a> </li> <li class=md-nav__item> <a href=#detailed_forpath class=md-nav__link> <span class=md-ellipsis> detailed_for(path) </span> </a> </li> <li class=md-nav__item> <a href=#raw_forpath class=md-nav__link> <span class=md-ellipsis> raw_for(path) </span> </a> </li> <li class=md-nav__item> <a href=#format_tablerows-nil-sort_order-descending-raise_on_stale-nil-tracked_globs-nil class=md-nav__link> <span class=md-ellipsis> format_table(rows = nil, sort_order: :descending, raise_on_stale: nil, tracked_globs: nil) </span> </a> </li> <li class=md-nav__item> <a href=#project_totalstracked_globs-raise_on_stale-nil class=md-nav__link> <span class=md-ellipsis> project_totals(tracked_globs: [], raise_on_stale: nil) </span> </a> </li> <li class=md-nav__item> <a href=#relativizedata class=md-nav__link> <span class=md-ellipsis> relativize(data) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#return-types class=md-nav__link> <span class=md-ellipsis> Return Types </span> </a> <nav class=md-nav aria-label="Return Types"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#list class=md-nav__link> <span class=md-ellipsis> list </span> </a> </li> <li class=md-nav__item> <a href=#summary_for class=md-nav__link> <span class=md-ellipsis> summary_for </span> </a> </li> <li class=md-nav__item> <a href=#uncovered_for class=md-nav__link> <span class=md-ellipsis> uncovered_for </span> </a> </li> <li class=md-nav__item> <a href=#detailed_for class=md-nav__link> <span class=md-ellipsis> detailed_for </span> </a> </li> <li class=md-nav__item> <a href=#raw_for class=md-nav__link> <span class=md-ellipsis> raw_for </span> </a> </li> <li class=md-nav__item> <a href=#project_totals class=md-nav__link> <span class=md-ellipsis> project_totals </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#error-handling class=md-nav__link> <span class=md-ellipsis> Error Handling </span> </a> <nav class=md-nav aria-label="Error Handling"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#exception-types class=md-nav__link> <span class=md-ellipsis> Exception Types </span> </a> </li> <li class=md-nav__item> <a href=#basic-error-handling class=md-nav__link> <span class=md-ellipsis> Basic Error Handling </span> </a> </li> <li class=md-nav__item> <a href=#handling-stale-coverage class=md-nav__link> <span class=md-ellipsis> Handling Stale Coverage </span> </a> </li> <li class=md-nav__item> <a href=#graceful-degradation class=md-nav__link> <span class=md-ellipsis> Graceful Degradation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#advanced-recipes class=md-nav__link> <span class=md-ellipsis> Advanced Recipes </span> </a> <nav class=md-nav aria-label="Advanced Recipes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#batch-file-analysis class=md-nav__link> <span class=md-ellipsis> Batch File Analysis </span> </a> </li> <li class=md-nav__item> <a href=#coverage-threshold-validation class=md-nav__link> <span class=md-ellipsis> Coverage Threshold Validation </span> </a> </li> <li class=md-nav__item> <a href=#directory-level-aggregation class=md-nav__link> <span class=md-ellipsis> Directory-Level Aggregation </span> </a> </li> <li class=md-nav__item> <a href=#coverage-delta-tracking class=md-nav__link> <span class=md-ellipsis> Coverage Delta Tracking </span> </a> </li> <li class=md-nav__item> <a href=#custom-reporting class=md-nav__link> <span class=md-ellipsis> Custom Reporting </span> </a> </li> <li class=md-nav__item> <a href=#per-model-context-advanced class=md-nav__link> <span class=md-ellipsis> Per-Model Context (Advanced) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#staleness-detection class=md-nav__link> <span class=md-ellipsis> Staleness Detection </span> </a> </li> <li class=md-nav__item> <a href=#related-documentation class=md-nav__link> <span class=md-ellipsis> Related Documentation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../ADVANCED_USAGE/ class=md-nav__link> <span class=md-ellipsis> Advanced Usage </span> </a> </li> <li class=md-nav__item> <a href=../ERROR_HANDLING/ class=md-nav__link> <span class=md-ellipsis> Error Handling </span> </a> </li> <li class=md-nav__item> <a href=../TROUBLESHOOTING/ class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> </li> <li class=md-nav__item> <a href=../CLI_FALLBACK_FOR_LLMS/ class=md-nav__link> <span class=md-ellipsis> CLI Fallback for LLMs </span> </a> </li> <li class=md-nav__item> <a href=../installing-a-prelease-version-of-covloupe/ class=md-nav__link> <span class=md-ellipsis> Installing a Prerelease </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Migrations </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Migrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../migrations/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../migrations/MIGRATING_TO_V4/ class=md-nav__link> <span class=md-ellipsis> Migrating to v4 </span> </a> </li> <li class=md-nav__item> <a href=../migrations/MIGRATING_TO_V3/ class=md-nav__link> <span class=md-ellipsis> Migrating to v3 </span> </a> </li> <li class=md-nav__item> <a href=../migrations/MIGRATING_TO_V2/ class=md-nav__link> <span class=md-ellipsis> Migrating to v2 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Prompt Library </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Prompt Library </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../prompts/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../prompts/coverage-analysis-prompt/ class=md-nav__link> <span class=md-ellipsis> Coverage Analysis </span> </a> </li> <li class=md-nav__item> <a href=../prompts/use-cli-not-mcp-prompt/ class=md-nav__link> <span class=md-ellipsis> Use CLI Not MCP </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Developer Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Developer Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../dev/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../dev/ARCHITECTURE/ class=md-nav__link> <span class=md-ellipsis> Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../dev/DEVELOPMENT/ class=md-nav__link> <span class=md-ellipsis> Development </span> </a> </li> <li class=md-nav__item> <a href=../../dev/RELEASING/ class=md-nav__link> <span class=md-ellipsis> Releasing </span> </a> </li> <li class=md-nav__item> <a href=../../dev/FUTURE_ENHANCEMENTS/ class=md-nav__link> <span class=md-ellipsis> Future Enhancements </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6_6> <label class=md-nav__link for=__nav_6_6 id=__nav_6_6_label tabindex=0> <span class=md-ellipsis> Architecture Decisions </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6_6> <span class="md-nav__icon md-icon"></span> Architecture Decisions </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../dev/arch-decisions/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../dev/arch-decisions/application-architecture/ class=md-nav__link> <span class=md-ellipsis> Application Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../dev/arch-decisions/coverage-data-quality/ class=md-nav__link> <span class=md-ellipsis> Coverage Data Quality </span> </a> </li> <li class=md-nav__item> <a href=../../dev/arch-decisions/path-resolution/ class=md-nav__link> <span class=md-ellipsis> Path Resolution </span> </a> </li> <li class=md-nav__item> <a href=../../dev/arch-decisions/policy-validation/ class=md-nav__link> <span class=md-ellipsis> Policy Validation </span> </a> </li> <li class=md-nav__item> <a href=../../dev/arch-decisions/simplecov-integration/ class=md-nav__link> <span class=md-ellipsis> SimpleCov Integration </span> </a> </li> <li class=md-nav__item> <a href=../../dev/arch-decisions/output-character-mode/ class=md-nav__link> <span class=md-ellipsis> Output Character Mode </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../dev/presentations/cov-loupe-presentation/ class=md-nav__link> <span class=md-ellipsis> Presentations </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> <li class=md-nav__item> <a href=../../code_of_conduct/ class=md-nav__link> <span class=md-ellipsis> Code of Conduct </span> </a> </li> <li class=md-nav__item> <a href=../../release_notes/ class=md-nav__link> <span class=md-ellipsis> Release Notes </span> </a> </li> <li class=md-nav__item> <a href=../../license/ class=md-nav__link> <span class=md-ellipsis> License </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#table-of-contents class=md-nav__link> <span class=md-ellipsis> Table of Contents </span> </a> </li> <li class=md-nav__item> <a href=#quick-start class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> <li class=md-nav__item> <a href=#method-reference class=md-nav__link> <span class=md-ellipsis> Method Reference </span> </a> <nav class=md-nav aria-label="Method Reference"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#listsort_order-descending-raise_on_stale-nil-tracked_globs class=md-nav__link> <span class=md-ellipsis> list(sort_order: :descending, raise_on_stale: nil, tracked_globs: []) </span> </a> </li> <li class=md-nav__item> <a href=#summary_forpath class=md-nav__link> <span class=md-ellipsis> summary_for(path) </span> </a> </li> <li class=md-nav__item> <a href=#uncovered_forpath class=md-nav__link> <span class=md-ellipsis> uncovered_for(path) </span> </a> </li> <li class=md-nav__item> <a href=#detailed_forpath class=md-nav__link> <span class=md-ellipsis> detailed_for(path) </span> </a> </li> <li class=md-nav__item> <a href=#raw_forpath class=md-nav__link> <span class=md-ellipsis> raw_for(path) </span> </a> </li> <li class=md-nav__item> <a href=#format_tablerows-nil-sort_order-descending-raise_on_stale-nil-tracked_globs-nil class=md-nav__link> <span class=md-ellipsis> format_table(rows = nil, sort_order: :descending, raise_on_stale: nil, tracked_globs: nil) </span> </a> </li> <li class=md-nav__item> <a href=#project_totalstracked_globs-raise_on_stale-nil class=md-nav__link> <span class=md-ellipsis> project_totals(tracked_globs: [], raise_on_stale: nil) </span> </a> </li> <li class=md-nav__item> <a href=#relativizedata class=md-nav__link> <span class=md-ellipsis> relativize(data) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#return-types class=md-nav__link> <span class=md-ellipsis> Return Types </span> </a> <nav class=md-nav aria-label="Return Types"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#list class=md-nav__link> <span class=md-ellipsis> list </span> </a> </li> <li class=md-nav__item> <a href=#summary_for class=md-nav__link> <span class=md-ellipsis> summary_for </span> </a> </li> <li class=md-nav__item> <a href=#uncovered_for class=md-nav__link> <span class=md-ellipsis> uncovered_for </span> </a> </li> <li class=md-nav__item> <a href=#detailed_for class=md-nav__link> <span class=md-ellipsis> detailed_for </span> </a> </li> <li class=md-nav__item> <a href=#raw_for class=md-nav__link> <span class=md-ellipsis> raw_for </span> </a> </li> <li class=md-nav__item> <a href=#project_totals class=md-nav__link> <span class=md-ellipsis> project_totals </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#error-handling class=md-nav__link> <span class=md-ellipsis> Error Handling </span> </a> <nav class=md-nav aria-label="Error Handling"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#exception-types class=md-nav__link> <span class=md-ellipsis> Exception Types </span> </a> </li> <li class=md-nav__item> <a href=#basic-error-handling class=md-nav__link> <span class=md-ellipsis> Basic Error Handling </span> </a> </li> <li class=md-nav__item> <a href=#handling-stale-coverage class=md-nav__link> <span class=md-ellipsis> Handling Stale Coverage </span> </a> </li> <li class=md-nav__item> <a href=#graceful-degradation class=md-nav__link> <span class=md-ellipsis> Graceful Degradation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#advanced-recipes class=md-nav__link> <span class=md-ellipsis> Advanced Recipes </span> </a> <nav class=md-nav aria-label="Advanced Recipes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#batch-file-analysis class=md-nav__link> <span class=md-ellipsis> Batch File Analysis </span> </a> </li> <li class=md-nav__item> <a href=#coverage-threshold-validation class=md-nav__link> <span class=md-ellipsis> Coverage Threshold Validation </span> </a> </li> <li class=md-nav__item> <a href=#directory-level-aggregation class=md-nav__link> <span class=md-ellipsis> Directory-Level Aggregation </span> </a> </li> <li class=md-nav__item> <a href=#coverage-delta-tracking class=md-nav__link> <span class=md-ellipsis> Coverage Delta Tracking </span> </a> </li> <li class=md-nav__item> <a href=#custom-reporting class=md-nav__link> <span class=md-ellipsis> Custom Reporting </span> </a> </li> <li class=md-nav__item> <a href=#per-model-context-advanced class=md-nav__link> <span class=md-ellipsis> Per-Model Context (Advanced) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#staleness-detection class=md-nav__link> <span class=md-ellipsis> Staleness Detection </span> </a> </li> <li class=md-nav__item> <a href=#related-documentation class=md-nav__link> <span class=md-ellipsis> Related Documentation </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=library-api-guide>Library API Guide<a class=headerlink href=#library-api-guide title="Permanent link">&para;</a></h1> <p><a href=../../ >Back to main README</a></p> <p>Use this gem programmatically to inspect coverage without running the CLI or MCP server. The primary entry point is <code>CovLoupe::CoverageModel</code>.</p> <h2 id=table-of-contents>Table of Contents<a class=headerlink href=#table-of-contents title="Permanent link">&para;</a></h2> <ul> <li><a href=#quick-start>Quick Start</a></li> <li><a href=#method-reference>Method Reference</a></li> <li><a href=#return-types>Return Types</a></li> <li><a href=#error-handling>Error Handling</a></li> <li><a href=#advanced-recipes>Advanced Recipes</a></li> </ul> <h2 id=quick-start>Quick Start<a class=headerlink href=#quick-start title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nb>require</span><span class=w> </span><span class=s2>&quot;cov_loupe&quot;</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=c1># Defaults (omit args; shown here with comments):</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=c1># - root: &quot;.&quot;</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=c1># - resultset: resolved from common paths under root</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=c1># - raise_on_stale: false (don&#39;t raise on stale data)</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=c1># - tracked_globs: [] (no project-level file-set checks)</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=n>model</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>CovLoupe</span><span class=o>::</span><span class=no>CoverageModel</span><span class=o>.</span><span class=n>new</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=c1># Custom configuration (non-default values):</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=n>model</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>CovLoupe</span><span class=o>::</span><span class=no>CoverageModel</span><span class=o>.</span><span class=n>new</span><span class=p>(</span>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=w>  </span><span class=ss>root</span><span class=p>:</span><span class=w> </span><span class=no>File</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=no>Dir</span><span class=o>.</span><span class=n>home</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;project&#39;</span><span class=p>),</span><span class=w>          </span><span class=c1># non-default project root</span>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=w>  </span><span class=ss>resultset</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;build/coverage&quot;</span><span class=p>,</span><span class=w>                   </span><span class=c1># file or directory containing .resultset.json</span>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=w>  </span><span class=ss>raise_on_stale</span><span class=p>:</span><span class=w> </span><span class=kp>true</span><span class=p>,</span><span class=w>                          </span><span class=c1># enable strict staleness checks (raise on stale)</span>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=w>  </span><span class=ss>tracked_globs</span><span class=p>:</span><span class=w> </span><span class=o>[</span><span class=s2>&quot;lib/cov_loupe/tools/**/*.rb&quot;</span><span class=o>]</span><span class=w> </span><span class=c1># for &#39;list&#39; staleness: flag new/missing files</span>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=p>)</span>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a><span class=c1># List all files with coverage summary</span>
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a><span class=n>list_result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span><span class=o>.</span><span class=n>list</span>
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a><span class=n>files</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>list_result</span><span class=o>[</span><span class=s1>&#39;files&#39;</span><span class=o>]</span>
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a><span class=c1># Per-file queries</span>
<a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a>
<a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a><span class=n>target</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;lib/cov_loupe/base_tool.rb&#39;</span>
<a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a><span class=n>summary</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span><span class=o>.</span><span class=n>summary_for</span><span class=p>(</span><span class=n>target</span><span class=p>)</span>
<a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a><span class=n>uncovered</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span><span class=o>.</span><span class=n>uncovered_for</span><span class=p>(</span><span class=n>target</span><span class=p>)</span>
<a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a><span class=n>detailed</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span><span class=o>.</span><span class=n>detailed_for</span><span class=p>(</span><span class=n>target</span><span class=p>)</span>
<a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a><span class=n>raw</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span><span class=o>.</span><span class=n>raw_for</span><span class=p>(</span><span class=n>target</span><span class=p>)</span>
</code></pre></div> <h2 id=method-reference>Method Reference<a class=headerlink href=#method-reference title="Permanent link">&para;</a></h2> <h3 id=listsort_order-descending-raise_on_stale-nil-tracked_globs><code>list(sort_order: :descending, raise_on_stale: nil, tracked_globs: [])</code><a class=headerlink href=#listsort_order-descending-raise_on_stale-nil-tracked_globs title="Permanent link">&para;</a></h3> <p>Returns coverage summary for all files in the resultset.</p> <p><strong>Parameters:</strong> - <code>sort_order</code> (Symbol, optional): <code>:descending</code> (default) or <code>:ascending</code> by coverage percentage - <code>raise_on_stale</code> (Boolean, optional): Whether to raise error if project is stale. Defaults to model setting. - <code>tracked_globs</code> (Array<string>, optional): Patterns to filter files (also used for staleness checks)</p> <p><strong>Returns:</strong> <code>Hash</code> - See <a href=#list>list return type</a></p> <p><strong>Example:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=n>list_result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span><span class=o>.</span><span class=n>list</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=n>files</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>list_result</span><span class=o>[</span><span class=s1>&#39;files&#39;</span><span class=o>]</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=c1># =&gt; [ { &#39;file&#39; =&gt; &#39;/abs/path/lib/foo.rb&#39;, &#39;covered&#39; =&gt; 12, &#39;total&#39; =&gt; 14, &#39;percentage&#39; =&gt; 85.71, &#39;stale&#39; =&gt; &quot;ok&quot; }, ... ]</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=c1># Get worst coverage first</span>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=n>worst_files</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span><span class=o>.</span><span class=n>list</span><span class=p>(</span><span class=ss>sort_order</span><span class=p>:</span><span class=w> </span><span class=ss>:ascending</span><span class=p>)</span><span class=o>[</span><span class=s1>&#39;files&#39;</span><span class=o>].</span><span class=n>first</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=c1># Force staleness check</span>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=n>model</span><span class=o>.</span><span class=n>list</span><span class=p>(</span><span class=ss>raise_on_stale</span><span class=p>:</span><span class=w> </span><span class=kp>true</span><span class=p>)</span>
</code></pre></div></p> <h3 id=summary_forpath><code>summary_for(path)</code><a class=headerlink href=#summary_forpath title="Permanent link">&para;</a></h3> <p>Returns coverage summary for a specific file.</p> <p><strong>Parameters:</strong> - <code>path</code> (String): File path (absolute or relative to root)</p> <p><strong>Returns:</strong> <code>Hash</code> - See <a href=#summary_for>summary_for return type</a></p> <p><strong>Raises:</strong> <code>CovLoupe::FileError</code> if file not in coverage data</p> <p><strong>Example:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=n>summary</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span><span class=o>.</span><span class=n>summary_for</span><span class=p>(</span><span class=n>target</span><span class=p>)</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=c1># =&gt; { &#39;file&#39; =&gt; &#39;/abs/.../lib/foo.rb&#39;, &#39;summary&#39; =&gt; {&#39;covered&#39;=&gt;12, &#39;total&#39;=&gt;14, &#39;percentage&#39;=&gt;85.71} }</span>
</code></pre></div></p> <h3 id=uncovered_forpath><code>uncovered_for(path)</code><a class=headerlink href=#uncovered_forpath title="Permanent link">&para;</a></h3> <p>Returns list of uncovered line numbers for a specific file.</p> <p><strong>Parameters:</strong> - <code>path</code> (String): File path (absolute or relative to root)</p> <p><strong>Returns:</strong> <code>Hash</code> - See <a href=#uncovered_for>uncovered_for return type</a></p> <p><strong>Raises:</strong> <code>CovLoupe::FileError</code> if file not in coverage data</p> <p><strong>Example:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=n>uncovered</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span><span class=o>.</span><span class=n>uncovered_for</span><span class=p>(</span><span class=s2>&quot;lib/foo.rb&quot;</span><span class=p>)</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=c1># =&gt; { &#39;file&#39; =&gt; &#39;/abs/.../lib/foo.rb&#39;, &#39;uncovered&#39; =&gt; [5, 9, 12], &#39;summary&#39; =&gt; { ... } }</span>
</code></pre></div></p> <h3 id=detailed_forpath><code>detailed_for(path)</code><a class=headerlink href=#detailed_forpath title="Permanent link">&para;</a></h3> <p>Returns per-line coverage details with hit counts.</p> <p><strong>Parameters:</strong> - <code>path</code> (String): File path (absolute or relative to root)</p> <p><strong>Returns:</strong> <code>Hash</code> - See <a href=#detailed_for>detailed_for return type</a></p> <p><strong>Raises:</strong> <code>CovLoupe::FileError</code> if file not in coverage data</p> <p><strong>Example:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=n>detailed</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span><span class=o>.</span><span class=n>detailed_for</span><span class=p>(</span><span class=s2>&quot;lib/foo.rb&quot;</span><span class=p>)</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=c1># =&gt; { &#39;file&#39; =&gt; &#39;/abs/.../lib/foo.rb&#39;, &#39;lines&#39; =&gt; [{&#39;line&#39; =&gt; 1, &#39;hits&#39; =&gt; 1, &#39;covered&#39; =&gt; true}, ...], &#39;summary&#39; =&gt; { ... } }</span>
</code></pre></div></p> <h3 id=raw_forpath><code>raw_for(path)</code><a class=headerlink href=#raw_forpath title="Permanent link">&para;</a></h3> <p>Returns raw SimpleCov lines array for a specific file.</p> <p><strong>Parameters:</strong> - <code>path</code> (String): File path (absolute or relative to root)</p> <p><strong>Returns:</strong> <code>Hash</code> - See <a href=#raw_for>raw_for return type</a></p> <p><strong>Raises:</strong> <code>CovLoupe::FileError</code> if file not in coverage data</p> <p><strong>Example:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=n>raw</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span><span class=o>.</span><span class=n>raw_for</span><span class=p>(</span><span class=s2>&quot;lib/foo.rb&quot;</span><span class=p>)</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=c1># =&gt; { &#39;file&#39; =&gt; &#39;/abs/.../lib/foo.rb&#39;, &#39;lines&#39; =&gt; [nil, 1, 0, 3, ...] }</span>
</code></pre></div></p> <h3 id=format_tablerows-nil-sort_order-descending-raise_on_stale-nil-tracked_globs-nil><code>format_table(rows = nil, sort_order: :descending, raise_on_stale: nil, tracked_globs: nil)</code><a class=headerlink href=#format_tablerows-nil-sort_order-descending-raise_on_stale-nil-tracked_globs-nil title="Permanent link">&para;</a></h3> <p>Generates formatted ASCII table string.</p> <p><strong>Parameters:</strong> - <code>rows</code> (Array<hash>, optional): Custom row data; defaults to <code>list</code> - <code>sort_order</code> (Symbol, optional): <code>:descending</code> (default) or <code>:ascending</code> - <code>raise_on_stale</code> (Boolean, optional): Whether to raise error if project is stale. Defaults to model setting. - <code>tracked_globs</code> (Array<string>, optional): Patterns to filter files.</p> <p><strong>Returns:</strong> <code>String</code> - Formatted table with Unicode borders</p> <p><strong>Example:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=c1># Default: all files</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=n>table</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span><span class=o>.</span><span class=n>format_table</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=nb>puts</span><span class=w> </span><span class=n>table</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=c1># Custom rows</span>
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=n>lib_files</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span><span class=o>.</span><span class=n>list</span><span class=o>[</span><span class=s1>&#39;files&#39;</span><span class=o>].</span><span class=n>select</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=o>|</span><span class=n>f</span><span class=o>|</span><span class=w> </span><span class=n>f</span><span class=o>[</span><span class=s1>&#39;file&#39;</span><span class=o>].</span><span class=n>include?</span><span class=p>(</span><span class=s1>&#39;/lib/&#39;</span><span class=p>)</span><span class=w> </span><span class=p>}</span>
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=n>lib_table</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span><span class=o>.</span><span class=n>format_table</span><span class=p>(</span><span class=n>lib_files</span><span class=p>,</span><span class=w> </span><span class=ss>sort_order</span><span class=p>:</span><span class=w> </span><span class=ss>:descending</span><span class=p>)</span>
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=nb>puts</span><span class=w> </span><span class=n>lib_table</span>
</code></pre></div></p> <h3 id=project_totalstracked_globs-raise_on_stale-nil><code>project_totals(tracked_globs: [], raise_on_stale: nil)</code><a class=headerlink href=#project_totalstracked_globs-raise_on_stale-nil title="Permanent link">&para;</a></h3> <p>Returns aggregated coverage totals across all files.</p> <p><strong>Parameters:</strong> - <code>tracked_globs</code> (Array<string> or String, optional): Glob patterns to filter files - <code>raise_on_stale</code> (Boolean, optional): Whether to raise error if project is stale. Defaults to model setting.</p> <p><strong>Returns:</strong> <code>Hash</code> - See <a href=#project_totals>project_totals return type</a></p> <p><strong>Example:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=n>totals</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span><span class=o>.</span><span class=n>project_totals</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=c1># =&gt; {</span>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=c1>#      &#39;lines&#39; =&gt; { &#39;total&#39; =&gt; 123, &#39;covered&#39; =&gt; 100, &#39;uncovered&#39; =&gt; 23, &#39;percent_covered&#39; =&gt; 81.3 },</span>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=c1>#      &#39;tracking&#39; =&gt; { &#39;enabled&#39; =&gt; true, &#39;globs&#39; =&gt; [&#39;lib/**/*.rb&#39;] },</span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=c1>#      &#39;files&#39; =&gt; { &#39;total&#39; =&gt; 4, &#39;with_coverage&#39; =&gt; { &#39;total&#39; =&gt; 4, &#39;ok&#39; =&gt; 4, &#39;stale&#39; =&gt; { ... } } }</span>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=c1>#    }</span>
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=c1># Filter to specific directory</span>
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=n>lib_totals</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span><span class=o>.</span><span class=n>project_totals</span><span class=p>(</span><span class=ss>tracked_globs</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;lib/**/*.rb&#39;</span><span class=p>)</span>
</code></pre></div></p> <p>When <code>raise_on_stale: true</code> is set, the method raises on stale coverage instead of returning totals. Otherwise, totals exclude stale files (<code>M</code>, <code>T</code>, <code>L</code>, <code>E</code>) from line counts and report stale breakdowns under <code>files['with_coverage']['stale']</code>.</p> <p>Note: The <code>without_coverage</code> hash will only be present if <code>tracked_globs</code> were specified.</p> <h3 id=relativizedata><code>relativize(data)</code><a class=headerlink href=#relativizedata title="Permanent link">&para;</a></h3> <p>Converts absolute file paths in coverage data to relative paths from project root.</p> <p><strong>Parameters:</strong> - <code>data</code> (Hash or Array<hash>): Coverage data with absolute file paths</p> <p><strong>Returns:</strong> <code>Hash</code> or <code>Array&lt;Hash&gt;</code> - Same structure with relative paths</p> <p><strong>Example:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=n>summary</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span><span class=o>.</span><span class=n>summary_for</span><span class=p>(</span><span class=s1>&#39;lib/cov_loupe/model.rb&#39;</span><span class=p>)</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=c1># =&gt; { &#39;file&#39; =&gt; &#39;/path/to/project/lib/cov_loupe/model.rb&#39;, ... }</span>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=n>relative_summary</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span><span class=o>.</span><span class=n>relativize</span><span class=p>(</span><span class=n>summary</span><span class=p>)</span>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=c1># =&gt; { &#39;file&#39; =&gt; &#39;lib/cov_loupe/model.rb&#39;, ... }</span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=c1># Works with arrays too</span>
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=n>list_result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span><span class=o>.</span><span class=n>list</span>
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=n>files</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>list_result</span><span class=o>[</span><span class=s1>&#39;files&#39;</span><span class=o>]</span>
<a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=n>relative_files</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span><span class=o>.</span><span class=n>relativize</span><span class=p>(</span><span class=n>files</span><span class=p>)</span>
</code></pre></div></p> <h2 id=return-types>Return Types<a class=headerlink href=#return-types title="Permanent link">&para;</a></h2> <h3 id=list><code>list</code><a class=headerlink href=#list title="Permanent link">&para;</a></h3> <p>Returns <code>Hash</code> with file data and staleness metadata:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=p>{</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=w>  </span><span class=s1>&#39;files&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=o>[</span>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=w>    </span><span class=p>{</span>
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=w>      </span><span class=s1>&#39;file&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>String</span><span class=p>,</span><span class=w>       </span><span class=c1># Absolute file path</span>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=w>      </span><span class=s1>&#39;covered&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Integer</span><span class=p>,</span><span class=w>   </span><span class=c1># Number of covered lines</span>
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=w>      </span><span class=s1>&#39;total&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Integer</span><span class=p>,</span><span class=w>     </span><span class=c1># Total relevant lines</span>
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=w>      </span><span class=s1>&#39;percentage&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Float</span><span class=p>,</span><span class=w>  </span><span class=c1># Coverage percentage (0.00-100.00)</span>
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=w>      </span><span class=s1>&#39;stale&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>String</span><span class=w>  </span><span class=c1># Staleness indicator: &quot;ok&quot;, &quot;error&quot;, &quot;missing&quot;, &quot;newer&quot;, or &quot;length_mismatch&quot;</span>
<a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=w>  </span><span class=o>]</span><span class=p>,</span>
<a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=w>  </span><span class=s1>&#39;skipped_files&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Array</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=p>,</span><span class=w>        </span><span class=c1># Files skipped due to coverage errors</span>
<a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=w>  </span><span class=s1>&#39;missing_tracked_files&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Array</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=p>,</span><span class=c1># Tracked files missing from coverage</span>
<a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=w>  </span><span class=s1>&#39;newer_files&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Array</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=p>,</span><span class=w>          </span><span class=c1># Files newer than coverage</span>
<a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=w>  </span><span class=s1>&#39;deleted_files&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Array</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=p>,</span><span class=w>        </span><span class=c1># Coverage entries for deleted files</span>
<a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a><span class=w>  </span><span class=s1>&#39;length_mismatch_files&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Array</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=p>,</span><span class=c1># Files whose line counts differ from coverage</span>
<a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a><span class=w>  </span><span class=s1>&#39;unreadable_files&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Array</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=w>      </span><span class=c1># Files that could not be read</span>
<a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a><span class=p>}</span>
</code></pre></div> <h3 id=summary_for><code>summary_for</code><a class=headerlink href=#summary_for title="Permanent link">&para;</a></h3> <p>Returns <code>Hash</code>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=p>{</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=w>  </span><span class=s1>&#39;file&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>String</span><span class=p>,</span><span class=w>       </span><span class=c1># Absolute file path</span>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=w>  </span><span class=s1>&#39;summary&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=w>    </span><span class=s1>&#39;covered&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Integer</span><span class=p>,</span><span class=w> </span><span class=c1># Number of covered lines</span>
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=w>    </span><span class=s1>&#39;total&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Integer</span><span class=p>,</span><span class=w>   </span><span class=c1># Total relevant lines</span>
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=w>    </span><span class=s1>&#39;percentage&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Float</span><span class=w>        </span><span class=c1># Coverage percentage (0.00-100.00)</span>
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=p>}</span>
</code></pre></div> <h3 id=uncovered_for><code>uncovered_for</code><a class=headerlink href=#uncovered_for title="Permanent link">&para;</a></h3> <p>Returns <code>Hash</code>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=p>{</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=w>  </span><span class=s1>&#39;file&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>String</span><span class=p>,</span><span class=w>       </span><span class=c1># Absolute file path</span>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=w>  </span><span class=s1>&#39;uncovered&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Array</span><span class=o>&lt;</span><span class=nb>Integer</span><span class=o>&gt;</span><span class=p>,</span><span class=w>  </span><span class=c1># Line numbers that are not covered</span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=w>  </span><span class=s1>&#39;summary&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=w>    </span><span class=s1>&#39;covered&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Integer</span><span class=p>,</span>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=w>    </span><span class=s1>&#39;total&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Integer</span><span class=p>,</span>
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=w>    </span><span class=s1>&#39;percentage&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Float</span>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=p>}</span>
</code></pre></div> <h3 id=detailed_for><code>detailed_for</code><a class=headerlink href=#detailed_for title="Permanent link">&para;</a></h3> <p>Returns <code>Hash</code>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=p>{</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=w>  </span><span class=s1>&#39;file&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>String</span><span class=p>,</span><span class=w>       </span><span class=c1># Absolute file path</span>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=w>  </span><span class=s1>&#39;lines&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Array</span><span class=o>&lt;</span><span class=no>Hash</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=c1># Per-line coverage details</span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=w>  </span><span class=s1>&#39;summary&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=w>    </span><span class=s1>&#39;covered&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Integer</span><span class=p>,</span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=w>    </span><span class=s1>&#39;total&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Integer</span><span class=p>,</span>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=w>    </span><span class=s1>&#39;percentage&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Float</span>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=p>}</span>
</code></pre></div> <p>Each element in <code>lines</code> array: <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=p>{</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=w>  </span><span class=s1>&#39;line&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Integer</span><span class=p>,</span><span class=w>    </span><span class=c1># Line number (1-indexed)</span>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=w>  </span><span class=s1>&#39;hits&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Integer</span><span class=p>,</span><span class=w>    </span><span class=c1># Execution count (0 means not covered)</span>
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=w>  </span><span class=s1>&#39;covered&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=no>Boolean</span><span class=w>  </span><span class=c1># true if hits &gt; 0</span>
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=p>}</span>
</code></pre></div></p> <h3 id=raw_for><code>raw_for</code><a class=headerlink href=#raw_for title="Permanent link">&para;</a></h3> <p>Returns <code>Hash</code>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=p>{</span>
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=w>  </span><span class=s1>&#39;file&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>String</span><span class=p>,</span><span class=w>              </span><span class=c1># Absolute file path</span>
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=w>  </span><span class=s1>&#39;lines&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Array</span><span class=o>&lt;</span><span class=nb>Integer</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=kp>nil</span><span class=o>&gt;</span><span class=w>   </span><span class=c1># SimpleCov lines array (nil = irrelevant, 0 = uncovered, &gt;0 = hit count)</span>
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=p>}</span>
</code></pre></div> <h3 id=project_totals><code>project_totals</code><a class=headerlink href=#project_totals title="Permanent link">&para;</a></h3> <p>Returns <code>Hash</code>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=p>{</span>
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=w>  </span><span class=s1>&#39;lines&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=w>    </span><span class=s1>&#39;total&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Integer</span><span class=p>,</span><span class=w>            </span><span class=c1># Total relevant lines across all files</span>
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=w>    </span><span class=s1>&#39;covered&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Integer</span><span class=p>,</span><span class=w>          </span><span class=c1># Total covered lines</span>
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=w>    </span><span class=s1>&#39;uncovered&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Integer</span><span class=p>,</span><span class=w>        </span><span class=c1># Total uncovered lines</span>
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=w>    </span><span class=s1>&#39;percent_covered&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Float</span><span class=w>     </span><span class=c1># Overall percent covered</span>
<a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=w>  </span><span class=p>},</span>
<a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=w>  </span><span class=s1>&#39;tracking&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=w>    </span><span class=s1>&#39;enabled&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=no>Boolean</span><span class=p>,</span><span class=w>          </span><span class=c1># Whether tracked_globs are active</span>
<a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a><span class=w>    </span><span class=s1>&#39;globs&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Array</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=w>       </span><span class=c1># Active tracked globs (empty when disabled)</span>
<a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a><span class=w>  </span><span class=p>},</span>
<a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a><span class=w>  </span><span class=s1>&#39;files&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a><span class=w>    </span><span class=s1>&#39;total&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Integer</span><span class=p>,</span><span class=w>          </span><span class=c1># Total number of files (with + without coverage)</span>
<a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a><span class=w>    </span><span class=s1>&#39;with_coverage&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a><span class=w>      </span><span class=s1>&#39;total&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Integer</span><span class=p>,</span><span class=w>        </span><span class=c1># Files with coverage entries</span>
<a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a><span class=w>      </span><span class=s1>&#39;ok&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Integer</span><span class=p>,</span><span class=w>           </span><span class=c1># Fresh coverage entries</span>
<a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a><span class=w>      </span><span class=s1>&#39;stale&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a><span class=w>        </span><span class=s1>&#39;total&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Integer</span><span class=p>,</span><span class=w>      </span><span class=c1># Stale coverage entries</span>
<a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a><span class=w>        </span><span class=s1>&#39;by_type&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-15-20 name=__codelineno-15-20 href=#__codelineno-15-20></a><span class=w>          </span><span class=s1>&#39;missing_from_disk&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Integer</span><span class=p>,</span>
<a id=__codelineno-15-21 name=__codelineno-15-21 href=#__codelineno-15-21></a><span class=w>          </span><span class=s1>&#39;newer&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Integer</span><span class=p>,</span>
<a id=__codelineno-15-22 name=__codelineno-15-22 href=#__codelineno-15-22></a><span class=w>          </span><span class=s1>&#39;length_mismatch&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Integer</span><span class=p>,</span>
<a id=__codelineno-15-23 name=__codelineno-15-23 href=#__codelineno-15-23></a><span class=w>          </span><span class=s1>&#39;unreadable&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Integer</span>
<a id=__codelineno-15-24 name=__codelineno-15-24 href=#__codelineno-15-24></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-15-25 name=__codelineno-15-25 href=#__codelineno-15-25></a><span class=w>      </span><span class=p>}</span>
<a id=__codelineno-15-26 name=__codelineno-15-26 href=#__codelineno-15-26></a><span class=w>    </span><span class=p>},</span>
<a id=__codelineno-15-27 name=__codelineno-15-27 href=#__codelineno-15-27></a><span class=w>    </span><span class=s1>&#39;without_coverage&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-15-28 name=__codelineno-15-28 href=#__codelineno-15-28></a><span class=w>      </span><span class=s1>&#39;total&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Integer</span><span class=p>,</span><span class=w>        </span><span class=c1># Tracked files missing coverage entries</span>
<a id=__codelineno-15-29 name=__codelineno-15-29 href=#__codelineno-15-29></a><span class=w>      </span><span class=s1>&#39;by_type&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-15-30 name=__codelineno-15-30 href=#__codelineno-15-30></a><span class=w>        </span><span class=s1>&#39;missing_from_coverage&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Integer</span><span class=p>,</span>
<a id=__codelineno-15-31 name=__codelineno-15-31 href=#__codelineno-15-31></a><span class=w>        </span><span class=s1>&#39;unreadable&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Integer</span><span class=p>,</span>
<a id=__codelineno-15-32 name=__codelineno-15-32 href=#__codelineno-15-32></a><span class=w>        </span><span class=s1>&#39;skipped&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Integer</span>
<a id=__codelineno-15-33 name=__codelineno-15-33 href=#__codelineno-15-33></a><span class=w>      </span><span class=p>}</span>
<a id=__codelineno-15-34 name=__codelineno-15-34 href=#__codelineno-15-34></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-15-35 name=__codelineno-15-35 href=#__codelineno-15-35></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-15-36 name=__codelineno-15-36 href=#__codelineno-15-36></a><span class=p>}</span>
</code></pre></div> <p>Note: The <code>without_coverage</code> hash will only be present if <code>tracked_globs</code> were specified.</p> <h2 id=error-handling>Error Handling<a class=headerlink href=#error-handling title="Permanent link">&para;</a></h2> <h3 id=exception-types>Exception Types<a class=headerlink href=#exception-types title="Permanent link">&para;</a></h3> <p>The library raises these custom exceptions:</p> <ul> <li><strong><code>CovLoupe::ResultsetNotFoundError</code></strong> - Coverage data file not found</li> <li><strong><code>CovLoupe::FileError</code></strong> - Requested file not in coverage data</li> <li><strong><code>CovLoupe::CoverageDataStaleError</code></strong> - Coverage data is stale (only when <code>raise_on_stale: true</code>)</li> <li><strong><code>CovLoupe::CoverageDataError</code></strong> - Invalid coverage data format or structure</li> </ul> <p>All exceptions inherit from <code>CovLoupe::Error</code>.</p> <h3 id=basic-error-handling>Basic Error Handling<a class=headerlink href=#basic-error-handling title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=nb>require</span><span class=w> </span><span class=s2>&quot;cov_loupe&quot;</span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=k>begin</span>
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=w>  </span><span class=n>model</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>CovLoupe</span><span class=o>::</span><span class=no>CoverageModel</span><span class=o>.</span><span class=n>new</span>
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=w>  </span><span class=n>summary</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span><span class=o>.</span><span class=n>summary_for</span><span class=p>(</span><span class=s2>&quot;lib/foo.rb&quot;</span><span class=p>)</span>
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=w>  </span><span class=nb>puts</span><span class=w> </span><span class=s2>&quot;Coverage: </span><span class=si>#{</span><span class=n>summary</span><span class=o>[</span><span class=s1>&#39;summary&#39;</span><span class=o>][</span><span class=s1>&#39;percentage&#39;</span><span class=o>]</span><span class=si>}</span><span class=s2>%&quot;</span>
<a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=k>rescue</span><span class=w> </span><span class=no>CovLoupe</span><span class=o>::</span><span class=no>FileError</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>e</span>
<a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=w>  </span><span class=nb>puts</span><span class=w> </span><span class=s2>&quot;File not in coverage data: </span><span class=si>#{</span><span class=n>e</span><span class=o>.</span><span class=n>message</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=k>rescue</span><span class=w> </span><span class=no>CovLoupe</span><span class=o>::</span><span class=no>ResultsetNotFoundError</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>e</span>
<a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a><span class=w>  </span><span class=nb>puts</span><span class=w> </span><span class=s2>&quot;Coverage data not found: </span><span class=si>#{</span><span class=n>e</span><span class=o>.</span><span class=n>message</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a><span class=w>  </span><span class=nb>puts</span><span class=w> </span><span class=s2>&quot;Run your tests first: bundle exec rspec&quot;</span>
<a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a><span class=k>rescue</span><span class=w> </span><span class=no>CovLoupe</span><span class=o>::</span><span class=no>Error</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>e</span>
<a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a><span class=w>  </span><span class=nb>puts</span><span class=w> </span><span class=s2>&quot;Coverage error: </span><span class=si>#{</span><span class=n>e</span><span class=o>.</span><span class=n>message</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a><span class=k>end</span>
</code></pre></div> <h3 id=handling-stale-coverage>Handling Stale Coverage<a class=headerlink href=#handling-stale-coverage title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=c1># Option 1: Check staleness without raising</span>
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=n>model</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>CovLoupe</span><span class=o>::</span><span class=no>CoverageModel</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=ss>raise_on_stale</span><span class=p>:</span><span class=w> </span><span class=kp>false</span><span class=p>)</span>
<a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=n>files</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span><span class=o>.</span><span class=n>list</span><span class=o>[</span><span class=s1>&#39;files&#39;</span><span class=o>]</span>
<a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>
<a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=n>stale_files</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>files</span><span class=o>.</span><span class=n>select</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=o>|</span><span class=n>f</span><span class=o>|</span><span class=w> </span><span class=n>f</span><span class=o>[</span><span class=s1>&#39;stale&#39;</span><span class=o>]</span><span class=w> </span><span class=p>}</span>
<a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=k>if</span><span class=w> </span><span class=n>stale_files</span><span class=o>.</span><span class=n>any?</span>
<a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=w>  </span><span class=nb>puts</span><span class=w> </span><span class=s2>&quot;Warning: </span><span class=si>#{</span><span class=n>stale_files</span><span class=o>.</span><span class=n>length</span><span class=si>}</span><span class=s2> files have stale coverage&quot;</span>
<a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=w>  </span><span class=n>stale_files</span><span class=o>.</span><span class=n>each</span><span class=w> </span><span class=k>do</span><span class=w> </span><span class=o>|</span><span class=n>f</span><span class=o>|</span>
<a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a><span class=w>    </span><span class=nb>puts</span><span class=w> </span><span class=s2>&quot;  </span><span class=si>#{</span><span class=n>f</span><span class=o>[</span><span class=s1>&#39;file&#39;</span><span class=o>]</span><span class=si>}</span><span class=s2>: </span><span class=si>#{</span><span class=n>f</span><span class=o>[</span><span class=s1>&#39;stale&#39;</span><span class=o>]</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a><span class=w>  </span><span class=k>end</span>
<a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=k>end</span>
<a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a>
<a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a><span class=c1># Option 2: Raise on staleness</span>
<a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a><span class=k>begin</span>
<a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a><span class=w>  </span><span class=n>model</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>CovLoupe</span><span class=o>::</span><span class=no>CoverageModel</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=ss>raise_on_stale</span><span class=p>:</span><span class=w> </span><span class=kp>true</span><span class=p>)</span>
<a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a><span class=w>  </span><span class=n>files</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span><span class=o>.</span><span class=n>list</span><span class=o>[</span><span class=s1>&#39;files&#39;</span><span class=o>]</span>
<a id=__codelineno-17-17 name=__codelineno-17-17 href=#__codelineno-17-17></a><span class=k>rescue</span><span class=w> </span><span class=no>CovLoupe</span><span class=o>::</span><span class=no>CoverageDataStaleError</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>e</span>
<a id=__codelineno-17-18 name=__codelineno-17-18 href=#__codelineno-17-18></a><span class=w>  </span><span class=nb>puts</span><span class=w> </span><span class=s2>&quot;Stale coverage detected: </span><span class=si>#{</span><span class=n>e</span><span class=o>.</span><span class=n>message</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-17-19 name=__codelineno-17-19 href=#__codelineno-17-19></a><span class=w>  </span><span class=nb>puts</span><span class=w> </span><span class=s2>&quot;Re-run tests: bundle exec rspec&quot;</span>
<a id=__codelineno-17-20 name=__codelineno-17-20 href=#__codelineno-17-20></a><span class=w>  </span><span class=nb>exit</span><span class=w> </span><span class=mi>1</span>
<a id=__codelineno-17-21 name=__codelineno-17-21 href=#__codelineno-17-21></a><span class=k>end</span>
</code></pre></div> <h3 id=graceful-degradation>Graceful Degradation<a class=headerlink href=#graceful-degradation title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=c1># Try multiple file paths</span>
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=k>def</span><span class=w> </span><span class=nf>find_coverage</span><span class=p>(</span><span class=n>model</span><span class=p>,</span><span class=w> </span><span class=n>possible_paths</span><span class=p>)</span>
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=w>  </span><span class=n>possible_paths</span><span class=o>.</span><span class=n>each</span><span class=w> </span><span class=k>do</span><span class=w> </span><span class=o>|</span><span class=n>path</span><span class=o>|</span>
<a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=w>    </span><span class=k>begin</span>
<a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=w>      </span><span class=k>return</span><span class=w> </span><span class=n>model</span><span class=o>.</span><span class=n>summary_for</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
<a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=w>    </span><span class=k>rescue</span><span class=w> </span><span class=no>CovLoupe</span><span class=o>::</span><span class=no>FileError</span>
<a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=w>      </span><span class=k>next</span>
<a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=w>    </span><span class=k>end</span>
<a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a><span class=w>  </span><span class=k>end</span>
<a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a><span class=w>  </span><span class=kp>nil</span>
<a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a><span class=k>end</span>
<a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a>
<a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a><span class=n>summary</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>find_coverage</span><span class=p>(</span><span class=n>model</span><span class=p>,</span><span class=w> </span><span class=o>[</span>
<a id=__codelineno-18-14 name=__codelineno-18-14 href=#__codelineno-18-14></a><span class=w>  </span><span class=s2>&quot;lib/services/auth_service.rb&quot;</span><span class=p>,</span>
<a id=__codelineno-18-15 name=__codelineno-18-15 href=#__codelineno-18-15></a><span class=w>  </span><span class=s2>&quot;app/services/auth_service.rb&quot;</span><span class=p>,</span>
<a id=__codelineno-18-16 name=__codelineno-18-16 href=#__codelineno-18-16></a><span class=w>  </span><span class=s2>&quot;services/auth_service.rb&quot;</span>
<a id=__codelineno-18-17 name=__codelineno-18-17 href=#__codelineno-18-17></a><span class=o>]</span><span class=p>)</span>
<a id=__codelineno-18-18 name=__codelineno-18-18 href=#__codelineno-18-18></a>
<a id=__codelineno-18-19 name=__codelineno-18-19 href=#__codelineno-18-19></a><span class=k>if</span><span class=w> </span><span class=n>summary</span>
<a id=__codelineno-18-20 name=__codelineno-18-20 href=#__codelineno-18-20></a><span class=w>  </span><span class=nb>puts</span><span class=w> </span><span class=s2>&quot;Coverage: </span><span class=si>#{</span><span class=n>summary</span><span class=o>[</span><span class=s1>&#39;summary&#39;</span><span class=o>][</span><span class=s1>&#39;percentage&#39;</span><span class=o>]</span><span class=si>}</span><span class=s2>%&quot;</span>
<a id=__codelineno-18-21 name=__codelineno-18-21 href=#__codelineno-18-21></a><span class=k>else</span>
<a id=__codelineno-18-22 name=__codelineno-18-22 href=#__codelineno-18-22></a><span class=w>  </span><span class=nb>puts</span><span class=w> </span><span class=s2>&quot;File not found in coverage data&quot;</span>
<a id=__codelineno-18-23 name=__codelineno-18-23 href=#__codelineno-18-23></a><span class=k>end</span>
</code></pre></div> <h2 id=advanced-recipes>Advanced Recipes<a class=headerlink href=#advanced-recipes title="Permanent link">&para;</a></h2> <h3 id=batch-file-analysis>Batch File Analysis<a class=headerlink href=#batch-file-analysis title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=nb>require</span><span class=w> </span><span class=s2>&quot;cov_loupe&quot;</span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=n>model</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>CovLoupe</span><span class=o>::</span><span class=no>CoverageModel</span><span class=o>.</span><span class=n>new</span>
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a>
<a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=c1># Analyze multiple files efficiently</span>
<a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=n>files_to_check</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>[</span>
<a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=w>  </span><span class=s2>&quot;lib/auth_service.rb&quot;</span><span class=p>,</span>
<a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=w>  </span><span class=s2>&quot;lib/payment_processor.rb&quot;</span><span class=p>,</span>
<a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=w>  </span><span class=s2>&quot;lib/user_manager.rb&quot;</span>
<a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a><span class=o>]</span>
<a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a>
<a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a><span class=n>results</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>files_to_check</span><span class=o>.</span><span class=n>map</span><span class=w> </span><span class=k>do</span><span class=w> </span><span class=o>|</span><span class=n>path</span><span class=o>|</span>
<a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a><span class=w>  </span><span class=k>begin</span>
<a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a><span class=w>    </span><span class=n>summary</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span><span class=o>.</span><span class=n>summary_for</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
<a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a><span class=w>    </span><span class=p>{</span>
<a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a><span class=w>      </span><span class=ss>file</span><span class=p>:</span><span class=w> </span><span class=n>path</span><span class=p>,</span>
<a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a><span class=w>      </span><span class=ss>coverage</span><span class=p>:</span><span class=w> </span><span class=n>summary</span><span class=o>[</span><span class=s1>&#39;summary&#39;</span><span class=o>][</span><span class=s1>&#39;percentage&#39;</span><span class=o>]</span><span class=p>,</span>
<a id=__codelineno-19-18 name=__codelineno-19-18 href=#__codelineno-19-18></a><span class=w>      </span><span class=ss>status</span><span class=p>:</span><span class=w> </span><span class=n>summary</span><span class=o>[</span><span class=s1>&#39;summary&#39;</span><span class=o>][</span><span class=s1>&#39;percentage&#39;</span><span class=o>]</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mi>80</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=ss>:ok</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=ss>:low</span>
<a id=__codelineno-19-19 name=__codelineno-19-19 href=#__codelineno-19-19></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-19-20 name=__codelineno-19-20 href=#__codelineno-19-20></a><span class=w>  </span><span class=k>rescue</span><span class=w> </span><span class=no>CovLoupe</span><span class=o>::</span><span class=no>FileError</span>
<a id=__codelineno-19-21 name=__codelineno-19-21 href=#__codelineno-19-21></a><span class=w>    </span><span class=p>{</span>
<a id=__codelineno-19-22 name=__codelineno-19-22 href=#__codelineno-19-22></a><span class=w>      </span><span class=ss>file</span><span class=p>:</span><span class=w> </span><span class=n>path</span><span class=p>,</span>
<a id=__codelineno-19-23 name=__codelineno-19-23 href=#__codelineno-19-23></a><span class=w>      </span><span class=ss>coverage</span><span class=p>:</span><span class=w> </span><span class=kp>nil</span><span class=p>,</span>
<a id=__codelineno-19-24 name=__codelineno-19-24 href=#__codelineno-19-24></a><span class=w>      </span><span class=ss>status</span><span class=p>:</span><span class=w> </span><span class=ss>:missing</span>
<a id=__codelineno-19-25 name=__codelineno-19-25 href=#__codelineno-19-25></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-19-26 name=__codelineno-19-26 href=#__codelineno-19-26></a><span class=w>  </span><span class=k>end</span>
<a id=__codelineno-19-27 name=__codelineno-19-27 href=#__codelineno-19-27></a><span class=k>end</span>
<a id=__codelineno-19-28 name=__codelineno-19-28 href=#__codelineno-19-28></a>
<a id=__codelineno-19-29 name=__codelineno-19-29 href=#__codelineno-19-29></a><span class=c1># Report</span>
<a id=__codelineno-19-30 name=__codelineno-19-30 href=#__codelineno-19-30></a><span class=n>results</span><span class=o>.</span><span class=n>each</span><span class=w> </span><span class=k>do</span><span class=w> </span><span class=o>|</span><span class=n>r</span><span class=o>|</span>
<a id=__codelineno-19-31 name=__codelineno-19-31 href=#__codelineno-19-31></a><span class=w>  </span><span class=n>status_icon</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=ss>ok</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=ss>low</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=ss>missing</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w> </span><span class=p>}</span><span class=o>[</span><span class=n>r</span><span class=o>[</span><span class=ss>:status</span><span class=o>]]</span>
<a id=__codelineno-19-32 name=__codelineno-19-32 href=#__codelineno-19-32></a><span class=w>  </span><span class=nb>puts</span><span class=w> </span><span class=s2>&quot;</span><span class=si>#{</span><span class=n>status_icon</span><span class=si>}</span><span class=s2> </span><span class=si>#{</span><span class=n>r</span><span class=o>[</span><span class=ss>:file</span><span class=o>]</span><span class=si>}</span><span class=s2>: </span><span class=si>#{</span><span class=n>r</span><span class=o>[</span><span class=ss>:coverage</span><span class=o>]</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=s1>&#39;N/A&#39;</span><span class=si>}</span><span class=s2>%&quot;</span>
<a id=__codelineno-19-33 name=__codelineno-19-33 href=#__codelineno-19-33></a><span class=k>end</span>
</code></pre></div> <h3 id=coverage-threshold-validation>Coverage Threshold Validation<a class=headerlink href=#coverage-threshold-validation title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=nb>require</span><span class=w> </span><span class=s2>&quot;cov_loupe&quot;</span>
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a>
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=k>class</span><span class=w> </span><span class=nc>CoverageValidator</span>
<a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=w>  </span><span class=no>THRESHOLDS</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=w>    </span><span class=s1>&#39;lib/api/&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=mi>90</span><span class=o>.</span><span class=mi>0</span><span class=p>,</span><span class=w>         </span><span class=c1># API layer needs 90%+</span>
<a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=w>    </span><span class=s1>&#39;app/models/&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=mi>85</span><span class=o>.</span><span class=mi>0</span><span class=p>,</span><span class=w>      </span><span class=c1># Models need 85%+</span>
<a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=w>    </span><span class=s1>&#39;app/controllers/&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=mi>75</span><span class=o>.</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=c1># Controllers need 75%+</span>
<a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a>
<a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a><span class=w>  </span><span class=k>def</span><span class=w> </span><span class=nf>initialize</span><span class=p>(</span><span class=n>model</span><span class=p>)</span>
<a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a><span class=w>    </span><span class=vi>@model</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span>
<a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a><span class=w>  </span><span class=k>end</span>
<a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a>
<a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a><span class=w>  </span><span class=k>def</span><span class=w> </span><span class=nf>validate!</span>
<a id=__codelineno-20-15 name=__codelineno-20-15 href=#__codelineno-20-15></a><span class=w>    </span><span class=n>files</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=vi>@model</span><span class=o>.</span><span class=n>list</span><span class=o>[</span><span class=s1>&#39;files&#39;</span><span class=o>]</span>
<a id=__codelineno-20-16 name=__codelineno-20-16 href=#__codelineno-20-16></a><span class=w>    </span><span class=n>failures</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>[]</span>
<a id=__codelineno-20-17 name=__codelineno-20-17 href=#__codelineno-20-17></a>
<a id=__codelineno-20-18 name=__codelineno-20-18 href=#__codelineno-20-18></a><span class=w>    </span><span class=n>files</span><span class=o>.</span><span class=n>each</span><span class=w> </span><span class=k>do</span><span class=w> </span><span class=o>|</span><span class=n>file</span><span class=o>|</span>
<a id=__codelineno-20-19 name=__codelineno-20-19 href=#__codelineno-20-19></a><span class=w>      </span><span class=n>threshold</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>threshold_for</span><span class=p>(</span><span class=n>file</span><span class=o>[</span><span class=s1>&#39;file&#39;</span><span class=o>]</span><span class=p>)</span>
<a id=__codelineno-20-20 name=__codelineno-20-20 href=#__codelineno-20-20></a><span class=w>      </span><span class=k>next</span><span class=w> </span><span class=k>unless</span><span class=w> </span><span class=n>threshold</span>
<a id=__codelineno-20-21 name=__codelineno-20-21 href=#__codelineno-20-21></a>
<a id=__codelineno-20-22 name=__codelineno-20-22 href=#__codelineno-20-22></a><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=n>file</span><span class=o>[</span><span class=s1>&#39;percentage&#39;</span><span class=o>]</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>threshold</span>
<a id=__codelineno-20-23 name=__codelineno-20-23 href=#__codelineno-20-23></a><span class=w>        </span><span class=n>failures</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-20-24 name=__codelineno-20-24 href=#__codelineno-20-24></a><span class=w>          </span><span class=ss>file</span><span class=p>:</span><span class=w> </span><span class=n>file</span><span class=o>[</span><span class=s1>&#39;file&#39;</span><span class=o>]</span><span class=p>,</span>
<a id=__codelineno-20-25 name=__codelineno-20-25 href=#__codelineno-20-25></a><span class=w>          </span><span class=ss>actual</span><span class=p>:</span><span class=w> </span><span class=n>file</span><span class=o>[</span><span class=s1>&#39;percentage&#39;</span><span class=o>]</span><span class=p>,</span>
<a id=__codelineno-20-26 name=__codelineno-20-26 href=#__codelineno-20-26></a><span class=w>          </span><span class=ss>required</span><span class=p>:</span><span class=w> </span><span class=n>threshold</span><span class=p>,</span>
<a id=__codelineno-20-27 name=__codelineno-20-27 href=#__codelineno-20-27></a><span class=w>          </span><span class=ss>gap</span><span class=p>:</span><span class=w> </span><span class=n>threshold</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>file</span><span class=o>[</span><span class=s1>&#39;percentage&#39;</span><span class=o>]</span>
<a id=__codelineno-20-28 name=__codelineno-20-28 href=#__codelineno-20-28></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-20-29 name=__codelineno-20-29 href=#__codelineno-20-29></a><span class=w>      </span><span class=k>end</span>
<a id=__codelineno-20-30 name=__codelineno-20-30 href=#__codelineno-20-30></a><span class=w>    </span><span class=k>end</span>
<a id=__codelineno-20-31 name=__codelineno-20-31 href=#__codelineno-20-31></a>
<a id=__codelineno-20-32 name=__codelineno-20-32 href=#__codelineno-20-32></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>failures</span><span class=o>.</span><span class=n>any?</span>
<a id=__codelineno-20-33 name=__codelineno-20-33 href=#__codelineno-20-33></a><span class=w>      </span><span class=nb>puts</span><span class=w> </span><span class=s2>&quot; </span><span class=si>#{</span><span class=n>failures</span><span class=o>.</span><span class=n>length</span><span class=si>}</span><span class=s2> files below coverage threshold:&quot;</span>
<a id=__codelineno-20-34 name=__codelineno-20-34 href=#__codelineno-20-34></a><span class=w>      </span><span class=n>failures</span><span class=o>.</span><span class=n>sort_by</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=o>|</span><span class=n>f</span><span class=o>|</span><span class=w> </span><span class=o>-</span><span class=n>f</span><span class=o>[</span><span class=ss>:gap</span><span class=o>]</span><span class=w> </span><span class=p>}</span><span class=o>.</span><span class=n>each</span><span class=w> </span><span class=k>do</span><span class=w> </span><span class=o>|</span><span class=n>f</span><span class=o>|</span>
<a id=__codelineno-20-35 name=__codelineno-20-35 href=#__codelineno-20-35></a><span class=w>        </span><span class=nb>puts</span><span class=w> </span><span class=s2>&quot;  </span><span class=si>#{</span><span class=n>f</span><span class=o>[</span><span class=ss>:file</span><span class=o>]</span><span class=si>}</span><span class=s2>: </span><span class=si>#{</span><span class=n>f</span><span class=o>[</span><span class=ss>:actual</span><span class=o>]</span><span class=si>}</span><span class=s2>% (need </span><span class=si>#{</span><span class=n>f</span><span class=o>[</span><span class=ss>:required</span><span class=o>]</span><span class=si>}</span><span class=s2>%)&quot;</span>
<a id=__codelineno-20-36 name=__codelineno-20-36 href=#__codelineno-20-36></a><span class=w>      </span><span class=k>end</span>
<a id=__codelineno-20-37 name=__codelineno-20-37 href=#__codelineno-20-37></a><span class=w>      </span><span class=nb>exit</span><span class=w> </span><span class=mi>1</span>
<a id=__codelineno-20-38 name=__codelineno-20-38 href=#__codelineno-20-38></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-20-39 name=__codelineno-20-39 href=#__codelineno-20-39></a><span class=w>      </span><span class=nb>puts</span><span class=w> </span><span class=s2>&quot; All files meet coverage thresholds&quot;</span>
<a id=__codelineno-20-40 name=__codelineno-20-40 href=#__codelineno-20-40></a><span class=w>    </span><span class=k>end</span>
<a id=__codelineno-20-41 name=__codelineno-20-41 href=#__codelineno-20-41></a><span class=w>  </span><span class=k>end</span>
<a id=__codelineno-20-42 name=__codelineno-20-42 href=#__codelineno-20-42></a>
<a id=__codelineno-20-43 name=__codelineno-20-43 href=#__codelineno-20-43></a><span class=w>  </span><span class=kp>private</span>
<a id=__codelineno-20-44 name=__codelineno-20-44 href=#__codelineno-20-44></a>
<a id=__codelineno-20-45 name=__codelineno-20-45 href=#__codelineno-20-45></a><span class=w>  </span><span class=k>def</span><span class=w> </span><span class=nf>threshold_for</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
<a id=__codelineno-20-46 name=__codelineno-20-46 href=#__codelineno-20-46></a><span class=w>    </span><span class=no>THRESHOLDS</span><span class=o>.</span><span class=n>each</span><span class=w> </span><span class=k>do</span><span class=w> </span><span class=o>|</span><span class=n>prefix</span><span class=p>,</span><span class=w> </span><span class=n>threshold</span><span class=o>|</span>
<a id=__codelineno-20-47 name=__codelineno-20-47 href=#__codelineno-20-47></a><span class=w>      </span><span class=k>return</span><span class=w> </span><span class=n>threshold</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=n>path</span><span class=o>.</span><span class=n>include?</span><span class=p>(</span><span class=n>prefix</span><span class=p>)</span>
<a id=__codelineno-20-48 name=__codelineno-20-48 href=#__codelineno-20-48></a><span class=w>    </span><span class=k>end</span>
<a id=__codelineno-20-49 name=__codelineno-20-49 href=#__codelineno-20-49></a><span class=w>    </span><span class=kp>nil</span>
<a id=__codelineno-20-50 name=__codelineno-20-50 href=#__codelineno-20-50></a><span class=w>  </span><span class=k>end</span>
<a id=__codelineno-20-51 name=__codelineno-20-51 href=#__codelineno-20-51></a><span class=k>end</span>
<a id=__codelineno-20-52 name=__codelineno-20-52 href=#__codelineno-20-52></a>
<a id=__codelineno-20-53 name=__codelineno-20-53 href=#__codelineno-20-53></a><span class=n>model</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>CovLoupe</span><span class=o>::</span><span class=no>CoverageModel</span><span class=o>.</span><span class=n>new</span>
<a id=__codelineno-20-54 name=__codelineno-20-54 href=#__codelineno-20-54></a><span class=n>validator</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>CoverageValidator</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>model</span><span class=p>)</span>
<a id=__codelineno-20-55 name=__codelineno-20-55 href=#__codelineno-20-55></a><span class=n>validator</span><span class=o>.</span><span class=n>validate!</span>
</code></pre></div> <h3 id=directory-level-aggregation>Directory-Level Aggregation<a class=headerlink href=#directory-level-aggregation title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=nb>require</span><span class=w> </span><span class=s2>&quot;cov_loupe&quot;</span>
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>
<a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=n>model</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>CovLoupe</span><span class=o>::</span><span class=no>CoverageModel</span><span class=o>.</span><span class=n>new</span>
<a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a>
<a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=c1># Calculate coverage by directory using the totals API</span>
<a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=n>patterns</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=sx>%w[lib/cov_loupe/tools/**/*.rb lib/cov_loupe/commands/**/*.rb lib/cov_loupe/presenters/**/*.rb]</span>
<a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a>
<a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=n>directory_stats</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>patterns</span><span class=o>.</span><span class=n>map</span><span class=w> </span><span class=k>do</span><span class=w> </span><span class=o>|</span><span class=n>pattern</span><span class=o>|</span>
<a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a><span class=w>  </span><span class=n>totals</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span><span class=o>.</span><span class=n>project_totals</span><span class=p>(</span><span class=ss>tracked_globs</span><span class=p>:</span><span class=w> </span><span class=n>pattern</span><span class=p>)</span>
<a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a>
<a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a><span class=w>  </span><span class=p>{</span>
<a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a><span class=w>    </span><span class=ss>directory</span><span class=p>:</span><span class=w> </span><span class=n>pattern</span><span class=p>,</span>
<a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a><span class=w>    </span><span class=ss>files</span><span class=p>:</span><span class=w> </span><span class=n>totals</span><span class=o>[</span><span class=s1>&#39;files&#39;</span><span class=o>][</span><span class=s1>&#39;total&#39;</span><span class=o>]</span><span class=p>,</span>
<a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a><span class=w>    </span><span class=ss>coverage</span><span class=p>:</span><span class=w> </span><span class=n>totals</span><span class=o>[</span><span class=s1>&#39;lines&#39;</span><span class=o>][</span><span class=s1>&#39;percent_covered&#39;</span><span class=o>].</span><span class=n>round</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span>
<a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a><span class=w>    </span><span class=ss>covered</span><span class=p>:</span><span class=w> </span><span class=n>totals</span><span class=o>[</span><span class=s1>&#39;lines&#39;</span><span class=o>][</span><span class=s1>&#39;covered&#39;</span><span class=o>]</span><span class=p>,</span>
<a id=__codelineno-21-16 name=__codelineno-21-16 href=#__codelineno-21-16></a><span class=w>    </span><span class=ss>total</span><span class=p>:</span><span class=w> </span><span class=n>totals</span><span class=o>[</span><span class=s1>&#39;lines&#39;</span><span class=o>][</span><span class=s1>&#39;total&#39;</span><span class=o>]</span>
<a id=__codelineno-21-17 name=__codelineno-21-17 href=#__codelineno-21-17></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-21-18 name=__codelineno-21-18 href=#__codelineno-21-18></a><span class=k>end</span>
<a id=__codelineno-21-19 name=__codelineno-21-19 href=#__codelineno-21-19></a>
<a id=__codelineno-21-20 name=__codelineno-21-20 href=#__codelineno-21-20></a><span class=c1># Display sorted by coverage</span>
<a id=__codelineno-21-21 name=__codelineno-21-21 href=#__codelineno-21-21></a><span class=n>directory_stats</span><span class=o>.</span><span class=n>sort_by</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=o>|</span><span class=n>s</span><span class=o>|</span><span class=w> </span><span class=n>s</span><span class=o>[</span><span class=ss>:coverage</span><span class=o>]</span><span class=w> </span><span class=p>}</span><span class=o>.</span><span class=n>each</span><span class=w> </span><span class=k>do</span><span class=w> </span><span class=o>|</span><span class=n>stat</span><span class=o>|</span>
<a id=__codelineno-21-22 name=__codelineno-21-22 href=#__codelineno-21-22></a><span class=w>  </span><span class=nb>puts</span><span class=w> </span><span class=s2>&quot;</span><span class=si>#{</span><span class=n>stat</span><span class=o>[</span><span class=ss>:directory</span><span class=o>]</span><span class=si>}</span><span class=s2>: </span><span class=si>#{</span><span class=n>stat</span><span class=o>[</span><span class=ss>:coverage</span><span class=o>]</span><span class=si>}</span><span class=s2>% (</span><span class=si>#{</span><span class=n>stat</span><span class=o>[</span><span class=ss>:files</span><span class=o>]</span><span class=si>}</span><span class=s2> files)&quot;</span>
<a id=__codelineno-21-23 name=__codelineno-21-23 href=#__codelineno-21-23></a><span class=k>end</span>
</code></pre></div> <h3 id=coverage-delta-tracking>Coverage Delta Tracking<a class=headerlink href=#coverage-delta-tracking title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=nb>require</span><span class=w> </span><span class=s2>&quot;cov_loupe&quot;</span>
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=nb>require</span><span class=w> </span><span class=s2>&quot;json&quot;</span>
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>
<a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=k>class</span><span class=w> </span><span class=nc>CoverageDeltaTracker</span>
<a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=w>  </span><span class=k>def</span><span class=w> </span><span class=nf>initialize</span><span class=p>(</span><span class=ss>baseline_path</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;coverage_baseline.json&quot;</span><span class=p>)</span>
<a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a><span class=w>    </span><span class=vi>@baseline_path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>baseline_path</span>
<a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=w>    </span><span class=vi>@model</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>CovLoupe</span><span class=o>::</span><span class=no>CoverageModel</span><span class=o>.</span><span class=n>new</span>
<a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a><span class=w>  </span><span class=k>end</span>
<a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a>
<a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a><span class=w>  </span><span class=k>def</span><span class=w> </span><span class=nf>save_baseline</span>
<a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a><span class=w>    </span><span class=n>current</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=vi>@model</span><span class=o>.</span><span class=n>list</span><span class=o>[</span><span class=s1>&#39;files&#39;</span><span class=o>]</span>
<a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a><span class=w>    </span><span class=no>File</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=vi>@baseline_path</span><span class=p>,</span><span class=w> </span><span class=no>JSON</span><span class=o>.</span><span class=n>pretty_generate</span><span class=p>(</span><span class=n>current</span><span class=p>))</span>
<a id=__codelineno-22-13 name=__codelineno-22-13 href=#__codelineno-22-13></a><span class=w>    </span><span class=nb>puts</span><span class=w> </span><span class=s2>&quot;Saved coverage baseline (</span><span class=si>#{</span><span class=n>current</span><span class=o>.</span><span class=n>length</span><span class=si>}</span><span class=s2> files)&quot;</span>
<a id=__codelineno-22-14 name=__codelineno-22-14 href=#__codelineno-22-14></a><span class=w>  </span><span class=k>end</span>
<a id=__codelineno-22-15 name=__codelineno-22-15 href=#__codelineno-22-15></a>
<a id=__codelineno-22-16 name=__codelineno-22-16 href=#__codelineno-22-16></a><span class=w>  </span><span class=k>def</span><span class=w> </span><span class=nf>compare</span>
<a id=__codelineno-22-17 name=__codelineno-22-17 href=#__codelineno-22-17></a><span class=w>    </span><span class=k>unless</span><span class=w> </span><span class=no>File</span><span class=o>.</span><span class=n>exist?</span><span class=p>(</span><span class=vi>@baseline_path</span><span class=p>)</span>
<a id=__codelineno-22-18 name=__codelineno-22-18 href=#__codelineno-22-18></a><span class=w>      </span><span class=nb>puts</span><span class=w> </span><span class=s2>&quot;No baseline found. Run save_baseline first.&quot;</span>
<a id=__codelineno-22-19 name=__codelineno-22-19 href=#__codelineno-22-19></a><span class=w>      </span><span class=k>return</span>
<a id=__codelineno-22-20 name=__codelineno-22-20 href=#__codelineno-22-20></a><span class=w>    </span><span class=k>end</span>
<a id=__codelineno-22-21 name=__codelineno-22-21 href=#__codelineno-22-21></a>
<a id=__codelineno-22-22 name=__codelineno-22-22 href=#__codelineno-22-22></a><span class=w>    </span><span class=n>baseline</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>JSON</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=no>File</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=vi>@baseline_path</span><span class=p>))</span>
<a id=__codelineno-22-23 name=__codelineno-22-23 href=#__codelineno-22-23></a><span class=w>    </span><span class=n>current</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=vi>@model</span><span class=o>.</span><span class=n>list</span><span class=o>[</span><span class=s1>&#39;files&#39;</span><span class=o>]</span>
<a id=__codelineno-22-24 name=__codelineno-22-24 href=#__codelineno-22-24></a>
<a id=__codelineno-22-25 name=__codelineno-22-25 href=#__codelineno-22-25></a><span class=w>    </span><span class=n>improved</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>[]</span>
<a id=__codelineno-22-26 name=__codelineno-22-26 href=#__codelineno-22-26></a><span class=w>    </span><span class=n>regressed</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>[]</span>
<a id=__codelineno-22-27 name=__codelineno-22-27 href=#__codelineno-22-27></a>
<a id=__codelineno-22-28 name=__codelineno-22-28 href=#__codelineno-22-28></a><span class=w>    </span><span class=n>current</span><span class=o>.</span><span class=n>each</span><span class=w> </span><span class=k>do</span><span class=w> </span><span class=o>|</span><span class=n>file</span><span class=o>|</span>
<a id=__codelineno-22-29 name=__codelineno-22-29 href=#__codelineno-22-29></a><span class=w>      </span><span class=n>baseline_file</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>baseline</span><span class=o>.</span><span class=n>find</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=o>|</span><span class=n>f</span><span class=o>|</span><span class=w> </span><span class=n>f</span><span class=o>[</span><span class=s1>&#39;file&#39;</span><span class=o>]</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>file</span><span class=o>[</span><span class=s1>&#39;file&#39;</span><span class=o>]</span><span class=w> </span><span class=p>}</span>
<a id=__codelineno-22-30 name=__codelineno-22-30 href=#__codelineno-22-30></a><span class=w>      </span><span class=k>next</span><span class=w> </span><span class=k>unless</span><span class=w> </span><span class=n>baseline_file</span>
<a id=__codelineno-22-31 name=__codelineno-22-31 href=#__codelineno-22-31></a>
<a id=__codelineno-22-32 name=__codelineno-22-32 href=#__codelineno-22-32></a><span class=w>      </span><span class=n>delta</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>file</span><span class=o>[</span><span class=s1>&#39;percentage&#39;</span><span class=o>]</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>baseline_file</span><span class=o>[</span><span class=s1>&#39;percentage&#39;</span><span class=o>]</span>
<a id=__codelineno-22-33 name=__codelineno-22-33 href=#__codelineno-22-33></a>
<a id=__codelineno-22-34 name=__codelineno-22-34 href=#__codelineno-22-34></a><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=n>delta</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=o>.</span><span class=mi>1</span>
<a id=__codelineno-22-35 name=__codelineno-22-35 href=#__codelineno-22-35></a><span class=w>        </span><span class=n>improved</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-22-36 name=__codelineno-22-36 href=#__codelineno-22-36></a><span class=w>          </span><span class=ss>file</span><span class=p>:</span><span class=w> </span><span class=n>file</span><span class=o>[</span><span class=s1>&#39;file&#39;</span><span class=o>]</span><span class=p>,</span>
<a id=__codelineno-22-37 name=__codelineno-22-37 href=#__codelineno-22-37></a><span class=w>          </span><span class=ss>before</span><span class=p>:</span><span class=w> </span><span class=n>baseline_file</span><span class=o>[</span><span class=s1>&#39;percentage&#39;</span><span class=o>]</span><span class=p>,</span>
<a id=__codelineno-22-38 name=__codelineno-22-38 href=#__codelineno-22-38></a><span class=w>          </span><span class=ss>after</span><span class=p>:</span><span class=w> </span><span class=n>file</span><span class=o>[</span><span class=s1>&#39;percentage&#39;</span><span class=o>]</span><span class=p>,</span>
<a id=__codelineno-22-39 name=__codelineno-22-39 href=#__codelineno-22-39></a><span class=w>          </span><span class=ss>delta</span><span class=p>:</span><span class=w> </span><span class=n>delta</span>
<a id=__codelineno-22-40 name=__codelineno-22-40 href=#__codelineno-22-40></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-22-41 name=__codelineno-22-41 href=#__codelineno-22-41></a><span class=w>      </span><span class=k>elsif</span><span class=w> </span><span class=n>delta</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=o>-</span><span class=mi>0</span><span class=o>.</span><span class=mi>1</span>
<a id=__codelineno-22-42 name=__codelineno-22-42 href=#__codelineno-22-42></a><span class=w>        </span><span class=n>regressed</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-22-43 name=__codelineno-22-43 href=#__codelineno-22-43></a><span class=w>          </span><span class=ss>file</span><span class=p>:</span><span class=w> </span><span class=n>file</span><span class=o>[</span><span class=s1>&#39;file&#39;</span><span class=o>]</span><span class=p>,</span>
<a id=__codelineno-22-44 name=__codelineno-22-44 href=#__codelineno-22-44></a><span class=w>          </span><span class=ss>before</span><span class=p>:</span><span class=w> </span><span class=n>baseline_file</span><span class=o>[</span><span class=s1>&#39;percentage&#39;</span><span class=o>]</span><span class=p>,</span>
<a id=__codelineno-22-45 name=__codelineno-22-45 href=#__codelineno-22-45></a><span class=w>          </span><span class=ss>after</span><span class=p>:</span><span class=w> </span><span class=n>file</span><span class=o>[</span><span class=s1>&#39;percentage&#39;</span><span class=o>]</span><span class=p>,</span>
<a id=__codelineno-22-46 name=__codelineno-22-46 href=#__codelineno-22-46></a><span class=w>          </span><span class=ss>delta</span><span class=p>:</span><span class=w> </span><span class=n>delta</span>
<a id=__codelineno-22-47 name=__codelineno-22-47 href=#__codelineno-22-47></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-22-48 name=__codelineno-22-48 href=#__codelineno-22-48></a><span class=w>      </span><span class=k>end</span>
<a id=__codelineno-22-49 name=__codelineno-22-49 href=#__codelineno-22-49></a><span class=w>    </span><span class=k>end</span>
<a id=__codelineno-22-50 name=__codelineno-22-50 href=#__codelineno-22-50></a>
<a id=__codelineno-22-51 name=__codelineno-22-51 href=#__codelineno-22-51></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>improved</span><span class=o>.</span><span class=n>any?</span>
<a id=__codelineno-22-52 name=__codelineno-22-52 href=#__codelineno-22-52></a><span class=w>      </span><span class=nb>puts</span><span class=w> </span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2> Coverage Improvements:&quot;</span>
<a id=__codelineno-22-53 name=__codelineno-22-53 href=#__codelineno-22-53></a><span class=w>      </span><span class=n>improved</span><span class=o>.</span><span class=n>sort_by</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=o>|</span><span class=n>f</span><span class=o>|</span><span class=w> </span><span class=o>-</span><span class=n>f</span><span class=o>[</span><span class=ss>:delta</span><span class=o>]</span><span class=w> </span><span class=p>}</span><span class=o>.</span><span class=n>each</span><span class=w> </span><span class=k>do</span><span class=w> </span><span class=o>|</span><span class=n>f</span><span class=o>|</span>
<a id=__codelineno-22-54 name=__codelineno-22-54 href=#__codelineno-22-54></a><span class=w>        </span><span class=nb>puts</span><span class=w> </span><span class=s2>&quot;  </span><span class=si>#{</span><span class=n>f</span><span class=o>[</span><span class=ss>:file</span><span class=o>]</span><span class=si>}</span><span class=s2>: </span><span class=si>#{</span><span class=n>f</span><span class=o>[</span><span class=ss>:before</span><span class=o>]</span><span class=si>}</span><span class=s2>%  </span><span class=si>#{</span><span class=n>f</span><span class=o>[</span><span class=ss>:after</span><span class=o>]</span><span class=si>}</span><span class=s2>% (+</span><span class=si>#{</span><span class=n>f</span><span class=o>[</span><span class=ss>:delta</span><span class=o>].</span><span class=n>round</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span><span class=si>}</span><span class=s2>%)&quot;</span>
<a id=__codelineno-22-55 name=__codelineno-22-55 href=#__codelineno-22-55></a><span class=w>      </span><span class=k>end</span>
<a id=__codelineno-22-56 name=__codelineno-22-56 href=#__codelineno-22-56></a><span class=w>    </span><span class=k>end</span>
<a id=__codelineno-22-57 name=__codelineno-22-57 href=#__codelineno-22-57></a>
<a id=__codelineno-22-58 name=__codelineno-22-58 href=#__codelineno-22-58></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>regressed</span><span class=o>.</span><span class=n>any?</span>
<a id=__codelineno-22-59 name=__codelineno-22-59 href=#__codelineno-22-59></a><span class=w>      </span><span class=nb>puts</span><span class=w> </span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2> Coverage Regressions:&quot;</span>
<a id=__codelineno-22-60 name=__codelineno-22-60 href=#__codelineno-22-60></a><span class=w>      </span><span class=n>regressed</span><span class=o>.</span><span class=n>sort_by</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=o>|</span><span class=n>f</span><span class=o>|</span><span class=w> </span><span class=n>f</span><span class=o>[</span><span class=ss>:delta</span><span class=o>]</span><span class=w> </span><span class=p>}</span><span class=o>.</span><span class=n>each</span><span class=w> </span><span class=k>do</span><span class=w> </span><span class=o>|</span><span class=n>f</span><span class=o>|</span>
<a id=__codelineno-22-61 name=__codelineno-22-61 href=#__codelineno-22-61></a><span class=w>        </span><span class=nb>puts</span><span class=w> </span><span class=s2>&quot;  </span><span class=si>#{</span><span class=n>f</span><span class=o>[</span><span class=ss>:file</span><span class=o>]</span><span class=si>}</span><span class=s2>: </span><span class=si>#{</span><span class=n>f</span><span class=o>[</span><span class=ss>:before</span><span class=o>]</span><span class=si>}</span><span class=s2>%  </span><span class=si>#{</span><span class=n>f</span><span class=o>[</span><span class=ss>:after</span><span class=o>]</span><span class=si>}</span><span class=s2>% (</span><span class=si>#{</span><span class=n>f</span><span class=o>[</span><span class=ss>:delta</span><span class=o>].</span><span class=n>round</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span><span class=si>}</span><span class=s2>%)&quot;</span>
<a id=__codelineno-22-62 name=__codelineno-22-62 href=#__codelineno-22-62></a><span class=w>      </span><span class=k>end</span>
<a id=__codelineno-22-63 name=__codelineno-22-63 href=#__codelineno-22-63></a><span class=w>    </span><span class=k>end</span>
<a id=__codelineno-22-64 name=__codelineno-22-64 href=#__codelineno-22-64></a>
<a id=__codelineno-22-65 name=__codelineno-22-65 href=#__codelineno-22-65></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>improved</span><span class=o>.</span><span class=n>empty?</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>regressed</span><span class=o>.</span><span class=n>empty?</span>
<a id=__codelineno-22-66 name=__codelineno-22-66 href=#__codelineno-22-66></a><span class=w>      </span><span class=nb>puts</span><span class=w> </span><span class=s2>&quot;No significant coverage changes&quot;</span>
<a id=__codelineno-22-67 name=__codelineno-22-67 href=#__codelineno-22-67></a><span class=w>    </span><span class=k>end</span>
<a id=__codelineno-22-68 name=__codelineno-22-68 href=#__codelineno-22-68></a><span class=w>  </span><span class=k>end</span>
<a id=__codelineno-22-69 name=__codelineno-22-69 href=#__codelineno-22-69></a><span class=k>end</span>
<a id=__codelineno-22-70 name=__codelineno-22-70 href=#__codelineno-22-70></a>
<a id=__codelineno-22-71 name=__codelineno-22-71 href=#__codelineno-22-71></a><span class=c1># Usage</span>
<a id=__codelineno-22-72 name=__codelineno-22-72 href=#__codelineno-22-72></a><span class=n>tracker</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>CoverageDeltaTracker</span><span class=o>.</span><span class=n>new</span>
<a id=__codelineno-22-73 name=__codelineno-22-73 href=#__codelineno-22-73></a><span class=n>tracker</span><span class=o>.</span><span class=n>save_baseline</span><span class=w>  </span><span class=c1># Run before making changes</span>
<a id=__codelineno-22-74 name=__codelineno-22-74 href=#__codelineno-22-74></a><span class=c1># ... make code changes and re-run tests ...</span>
<a id=__codelineno-22-75 name=__codelineno-22-75 href=#__codelineno-22-75></a><span class=n>tracker</span><span class=o>.</span><span class=n>compare</span><span class=w>        </span><span class=c1># See what changed</span>
</code></pre></div> <h3 id=custom-reporting>Custom Reporting<a class=headerlink href=#custom-reporting title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=nb>require</span><span class=w> </span><span class=s2>&quot;cov_loupe&quot;</span>
<a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>
<a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=k>class</span><span class=w> </span><span class=nc>CoverageReporter</span>
<a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=w>  </span><span class=k>def</span><span class=w> </span><span class=nf>initialize</span><span class=p>(</span><span class=n>model</span><span class=p>)</span>
<a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=w>    </span><span class=vi>@model</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model</span>
<a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=w>  </span><span class=k>end</span>
<a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a>
<a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=w>  </span><span class=k>def</span><span class=w> </span><span class=nf>generate_markdown_report</span><span class=p>(</span><span class=n>output_path</span><span class=p>)</span>
<a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=w>    </span><span class=n>files</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=vi>@model</span><span class=o>.</span><span class=n>list</span><span class=o>[</span><span class=s1>&#39;files&#39;</span><span class=o>]</span>
<a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=w>    </span><span class=n>totals</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=vi>@model</span><span class=o>.</span><span class=n>project_totals</span>
<a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a>
<a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a><span class=w>    </span><span class=c1># Overall stats</span>
<a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a><span class=w>    </span><span class=n>overall_percentage</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>totals</span><span class=o>[</span><span class=s1>&#39;lines&#39;</span><span class=o>][</span><span class=s1>&#39;percent_covered&#39;</span><span class=o>]</span>
<a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a><span class=w>    </span><span class=n>total_lines</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>totals</span><span class=o>[</span><span class=s1>&#39;lines&#39;</span><span class=o>][</span><span class=s1>&#39;total&#39;</span><span class=o>]</span>
<a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a><span class=w>    </span><span class=n>covered_lines</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>totals</span><span class=o>[</span><span class=s1>&#39;lines&#39;</span><span class=o>][</span><span class=s1>&#39;covered&#39;</span><span class=o>]</span>
<a id=__codelineno-23-16 name=__codelineno-23-16 href=#__codelineno-23-16></a><span class=w>    </span><span class=n>total_files</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>totals</span><span class=o>[</span><span class=s1>&#39;files&#39;</span><span class=o>][</span><span class=s1>&#39;total&#39;</span><span class=o>]</span>
<a id=__codelineno-23-17 name=__codelineno-23-17 href=#__codelineno-23-17></a>
<a id=__codelineno-23-18 name=__codelineno-23-18 href=#__codelineno-23-18></a><span class=w>    </span><span class=c1># Files below threshold</span>
<a id=__codelineno-23-19 name=__codelineno-23-19 href=#__codelineno-23-19></a><span class=w>    </span><span class=n>threshold</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>80</span><span class=o>.</span><span class=mi>0</span>
<a id=__codelineno-23-20 name=__codelineno-23-20 href=#__codelineno-23-20></a><span class=w>    </span><span class=n>low_coverage</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>files</span><span class=o>.</span><span class=n>select</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=o>|</span><span class=n>file</span><span class=o>|</span><span class=w> </span><span class=n>file</span><span class=o>[</span><span class=s1>&#39;percentage&#39;</span><span class=o>]</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>threshold</span><span class=w> </span><span class=p>}</span>
<a id=__codelineno-23-21 name=__codelineno-23-21 href=#__codelineno-23-21></a>
<a id=__codelineno-23-22 name=__codelineno-23-22 href=#__codelineno-23-22></a><span class=w>    </span><span class=c1># Build low coverage table</span>
<a id=__codelineno-23-23 name=__codelineno-23-23 href=#__codelineno-23-23></a><span class=w>    </span><span class=n>low_coverage_section</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=n>low_coverage</span><span class=o>.</span><span class=n>any?</span>
<a id=__codelineno-23-24 name=__codelineno-23-24 href=#__codelineno-23-24></a><span class=w>      </span><span class=n>rows</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>low_coverage</span><span class=o>.</span><span class=n>sort_by</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=o>|</span><span class=n>file</span><span class=o>|</span><span class=w> </span><span class=n>file</span><span class=o>[</span><span class=s1>&#39;percentage&#39;</span><span class=o>]</span><span class=w> </span><span class=p>}</span><span class=o>.</span><span class=n>map</span><span class=w> </span><span class=k>do</span><span class=w> </span><span class=o>|</span><span class=n>file</span><span class=o>|</span>
<a id=__codelineno-23-25 name=__codelineno-23-25 href=#__codelineno-23-25></a><span class=w>        </span><span class=n>uncovered</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=vi>@model</span><span class=o>.</span><span class=n>uncovered_for</span><span class=p>(</span><span class=n>file</span><span class=o>[</span><span class=s1>&#39;file&#39;</span><span class=o>]</span><span class=p>)</span>
<a id=__codelineno-23-26 name=__codelineno-23-26 href=#__codelineno-23-26></a><span class=w>        </span><span class=n>missing_count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>uncovered</span><span class=o>[</span><span class=s1>&#39;uncovered&#39;</span><span class=o>].</span><span class=n>length</span>
<a id=__codelineno-23-27 name=__codelineno-23-27 href=#__codelineno-23-27></a><span class=w>        </span><span class=s2>&quot;| </span><span class=si>#{</span><span class=n>file</span><span class=o>[</span><span class=s1>&#39;file&#39;</span><span class=o>]</span><span class=si>}</span><span class=s2> | </span><span class=si>#{</span><span class=n>file</span><span class=o>[</span><span class=s1>&#39;percentage&#39;</span><span class=o>]</span><span class=si>}</span><span class=s2>% | </span><span class=si>#{</span><span class=n>missing_count</span><span class=si>}</span><span class=s2> |&quot;</span>
<a id=__codelineno-23-28 name=__codelineno-23-28 href=#__codelineno-23-28></a><span class=w>      </span><span class=k>end</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-23-29 name=__codelineno-23-29 href=#__codelineno-23-29></a>
<a id=__codelineno-23-30 name=__codelineno-23-30 href=#__codelineno-23-30></a><span class=w>      </span><span class=o>&lt;&lt;~</span><span class=dl>LOW_COVERAGE_TABLE</span>
<a id=__codelineno-23-31 name=__codelineno-23-31 href=#__codelineno-23-31></a>
<a id=__codelineno-23-32 name=__codelineno-23-32 href=#__codelineno-23-32></a><span class=sh>        ## Files Below #{threshold}% Coverage</span>
<a id=__codelineno-23-33 name=__codelineno-23-33 href=#__codelineno-23-33></a>
<a id=__codelineno-23-34 name=__codelineno-23-34 href=#__codelineno-23-34></a><span class=sh>        | File | Coverage | Missing Lines |</span>
<a id=__codelineno-23-35 name=__codelineno-23-35 href=#__codelineno-23-35></a><span class=sh>        |------|----------|---------------|</span>
<a id=__codelineno-23-36 name=__codelineno-23-36 href=#__codelineno-23-36></a><span class=sh>        #{rows}</span>
<a id=__codelineno-23-37 name=__codelineno-23-37 href=#__codelineno-23-37></a><span class=dl>      LOW_COVERAGE_TABLE</span>
<a id=__codelineno-23-38 name=__codelineno-23-38 href=#__codelineno-23-38></a><span class=w>    </span><span class=k>else</span>
<a id=__codelineno-23-39 name=__codelineno-23-39 href=#__codelineno-23-39></a><span class=w>      </span><span class=s2>&quot;&quot;</span>
<a id=__codelineno-23-40 name=__codelineno-23-40 href=#__codelineno-23-40></a><span class=w>    </span><span class=k>end</span>
<a id=__codelineno-23-41 name=__codelineno-23-41 href=#__codelineno-23-41></a>
<a id=__codelineno-23-42 name=__codelineno-23-42 href=#__codelineno-23-42></a><span class=w>    </span><span class=c1># Build top performers table</span>
<a id=__codelineno-23-43 name=__codelineno-23-43 href=#__codelineno-23-43></a><span class=w>    </span><span class=n>top_rows</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>files</span><span class=o>.</span><span class=n>sort_by</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=o>|</span><span class=n>file</span><span class=o>|</span><span class=w> </span><span class=o>-</span><span class=n>file</span><span class=o>[</span><span class=s1>&#39;percentage&#39;</span><span class=o>]</span><span class=w> </span><span class=p>}</span><span class=o>.</span><span class=n>take</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span><span class=o>.</span><span class=n>map</span><span class=w> </span><span class=k>do</span><span class=w> </span><span class=o>|</span><span class=n>file</span><span class=o>|</span>
<a id=__codelineno-23-44 name=__codelineno-23-44 href=#__codelineno-23-44></a><span class=w>      </span><span class=s2>&quot;| </span><span class=si>#{</span><span class=n>file</span><span class=o>[</span><span class=s1>&#39;file&#39;</span><span class=o>]</span><span class=si>}</span><span class=s2> | </span><span class=si>#{</span><span class=n>file</span><span class=o>[</span><span class=s1>&#39;percentage&#39;</span><span class=o>]</span><span class=si>}</span><span class=s2>% |&quot;</span>
<a id=__codelineno-23-45 name=__codelineno-23-45 href=#__codelineno-23-45></a><span class=w>    </span><span class=k>end</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-23-46 name=__codelineno-23-46 href=#__codelineno-23-46></a>
<a id=__codelineno-23-47 name=__codelineno-23-47 href=#__codelineno-23-47></a><span class=w>    </span><span class=c1># Generate report</span>
<a id=__codelineno-23-48 name=__codelineno-23-48 href=#__codelineno-23-48></a><span class=w>    </span><span class=n>report</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&lt;&lt;~</span><span class=dl>COVERAGE_REPORT</span>
<a id=__codelineno-23-49 name=__codelineno-23-49 href=#__codelineno-23-49></a><span class=sh>      # Coverage Report</span>
<a id=__codelineno-23-50 name=__codelineno-23-50 href=#__codelineno-23-50></a>
<a id=__codelineno-23-51 name=__codelineno-23-51 href=#__codelineno-23-51></a><span class=sh>      Generated: #{Time.now.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;)}</span>
<a id=__codelineno-23-52 name=__codelineno-23-52 href=#__codelineno-23-52></a>
<a id=__codelineno-23-53 name=__codelineno-23-53 href=#__codelineno-23-53></a><span class=sh>      ## Overall Coverage: #{overall_percentage}%</span>
<a id=__codelineno-23-54 name=__codelineno-23-54 href=#__codelineno-23-54></a>
<a id=__codelineno-23-55 name=__codelineno-23-55 href=#__codelineno-23-55></a><span class=sh>      - Total Files: #{total_files}</span>
<a id=__codelineno-23-56 name=__codelineno-23-56 href=#__codelineno-23-56></a><span class=sh>      - Total Lines: #{total_lines}</span>
<a id=__codelineno-23-57 name=__codelineno-23-57 href=#__codelineno-23-57></a><span class=sh>      - Covered Lines: #{covered_lines}</span>
<a id=__codelineno-23-58 name=__codelineno-23-58 href=#__codelineno-23-58></a><span class=sh>      #{low_coverage_section}</span>
<a id=__codelineno-23-59 name=__codelineno-23-59 href=#__codelineno-23-59></a><span class=sh>      ## Top 10 Best Covered Files</span>
<a id=__codelineno-23-60 name=__codelineno-23-60 href=#__codelineno-23-60></a>
<a id=__codelineno-23-61 name=__codelineno-23-61 href=#__codelineno-23-61></a><span class=sh>      | File | Coverage |</span>
<a id=__codelineno-23-62 name=__codelineno-23-62 href=#__codelineno-23-62></a><span class=sh>      |------|----------|</span>
<a id=__codelineno-23-63 name=__codelineno-23-63 href=#__codelineno-23-63></a><span class=sh>      #{top_rows}</span>
<a id=__codelineno-23-64 name=__codelineno-23-64 href=#__codelineno-23-64></a><span class=dl>    COVERAGE_REPORT</span>
<a id=__codelineno-23-65 name=__codelineno-23-65 href=#__codelineno-23-65></a>
<a id=__codelineno-23-66 name=__codelineno-23-66 href=#__codelineno-23-66></a><span class=w>    </span><span class=no>File</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>output_path</span><span class=p>,</span><span class=w> </span><span class=n>report</span><span class=p>)</span>
<a id=__codelineno-23-67 name=__codelineno-23-67 href=#__codelineno-23-67></a><span class=w>    </span><span class=nb>puts</span><span class=w> </span><span class=s2>&quot;Report saved to </span><span class=si>#{</span><span class=n>output_path</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-23-68 name=__codelineno-23-68 href=#__codelineno-23-68></a><span class=w>  </span><span class=k>end</span>
<a id=__codelineno-23-69 name=__codelineno-23-69 href=#__codelineno-23-69></a><span class=k>end</span>
<a id=__codelineno-23-70 name=__codelineno-23-70 href=#__codelineno-23-70></a>
<a id=__codelineno-23-71 name=__codelineno-23-71 href=#__codelineno-23-71></a><span class=n>model</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>CovLoupe</span><span class=o>::</span><span class=no>CoverageModel</span><span class=o>.</span><span class=n>new</span>
<a id=__codelineno-23-72 name=__codelineno-23-72 href=#__codelineno-23-72></a><span class=n>reporter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>CoverageReporter</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>model</span><span class=p>)</span>
<a id=__codelineno-23-73 name=__codelineno-23-73 href=#__codelineno-23-73></a><span class=n>reporter</span><span class=o>.</span><span class=n>generate_markdown_report</span><span class=p>(</span><span class=s2>&quot;coverage_report.md&quot;</span><span class=p>)</span>
</code></pre></div> <h3 id=per-model-context-advanced>Per-Model Context (Advanced)<a class=headerlink href=#per-model-context-advanced title="Permanent link">&para;</a></h3> <p>By default, all <code>CoverageModel</code> instances share the global context for error handling and logging. For advanced scenarios where you need different models with different logging or error handling configurations in the same process, you can pass a custom context to each model.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=nb>require</span><span class=w> </span><span class=s2>&quot;cov_loupe&quot;</span>
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a>
<a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=c1># Scenario: Analyzing coverage for multiple projects in one script</span>
<a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a>
<a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=c1># Project A: Detailed logging for debugging</span>
<a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=n>context_a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>CovLoupe</span><span class=o>.</span><span class=n>create_context</span><span class=p>(</span>
<a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=w>  </span><span class=ss>error_handler</span><span class=p>:</span><span class=w> </span><span class=no>CovLoupe</span><span class=o>::</span><span class=no>ErrorHandlerFactory</span><span class=o>.</span><span class=n>for_library</span><span class=p>,</span>
<a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=w>  </span><span class=ss>log_target</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;project_a_coverage.log&#39;</span>
<a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=p>)</span>
<a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a>
<a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a><span class=n>model_a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>CovLoupe</span><span class=o>::</span><span class=no>CoverageModel</span><span class=o>.</span><span class=n>new</span><span class=p>(</span>
<a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a><span class=w>  </span><span class=ss>root</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;/path/to/project_a&#39;</span><span class=p>,</span>
<a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a><span class=w>  </span><span class=ss>resultset</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;/path/to/project_a/coverage/.resultset.json&#39;</span><span class=p>,</span>
<a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a><span class=w>  </span><span class=ss>context</span><span class=p>:</span><span class=w> </span><span class=n>context_a</span>
<a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a><span class=p>)</span>
<a id=__codelineno-24-16 name=__codelineno-24-16 href=#__codelineno-24-16></a>
<a id=__codelineno-24-17 name=__codelineno-24-17 href=#__codelineno-24-17></a><span class=c1># Project B: Different log file</span>
<a id=__codelineno-24-18 name=__codelineno-24-18 href=#__codelineno-24-18></a><span class=n>context_b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>context_a</span><span class=o>.</span><span class=n>with</span><span class=p>(</span><span class=ss>log_target</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;project_b_coverage.log&#39;</span><span class=p>)</span>
<a id=__codelineno-24-19 name=__codelineno-24-19 href=#__codelineno-24-19></a>
<a id=__codelineno-24-20 name=__codelineno-24-20 href=#__codelineno-24-20></a><span class=n>model_b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>CovLoupe</span><span class=o>::</span><span class=no>CoverageModel</span><span class=o>.</span><span class=n>new</span><span class=p>(</span>
<a id=__codelineno-24-21 name=__codelineno-24-21 href=#__codelineno-24-21></a><span class=w>  </span><span class=ss>root</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;/path/to/project_b&#39;</span><span class=p>,</span>
<a id=__codelineno-24-22 name=__codelineno-24-22 href=#__codelineno-24-22></a><span class=w>  </span><span class=ss>resultset</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;/path/to/project_b/coverage/.resultset.json&#39;</span><span class=p>,</span>
<a id=__codelineno-24-23 name=__codelineno-24-23 href=#__codelineno-24-23></a><span class=w>  </span><span class=ss>context</span><span class=p>:</span><span class=w> </span><span class=n>context_b</span>
<a id=__codelineno-24-24 name=__codelineno-24-24 href=#__codelineno-24-24></a><span class=p>)</span>
<a id=__codelineno-24-25 name=__codelineno-24-25 href=#__codelineno-24-25></a>
<a id=__codelineno-24-26 name=__codelineno-24-26 href=#__codelineno-24-26></a><span class=c1># Each model logs to its own file</span>
<a id=__codelineno-24-27 name=__codelineno-24-27 href=#__codelineno-24-27></a><span class=n>summary_a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model_a</span><span class=o>.</span><span class=n>summary_for</span><span class=p>(</span><span class=s1>&#39;lib/foo.rb&#39;</span><span class=p>)</span><span class=w>  </span><span class=c1># Logs to project_a_coverage.log</span>
<a id=__codelineno-24-28 name=__codelineno-24-28 href=#__codelineno-24-28></a><span class=n>summary_b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>model_b</span><span class=o>.</span><span class=n>summary_for</span><span class=p>(</span><span class=s1>&#39;lib/bar.rb&#39;</span><span class=p>)</span><span class=w>  </span><span class=c1># Logs to project_b_coverage.log</span>
<a id=__codelineno-24-29 name=__codelineno-24-29 href=#__codelineno-24-29></a>
<a id=__codelineno-24-30 name=__codelineno-24-30 href=#__codelineno-24-30></a><span class=c1># You can also change a model&#39;s context at runtime</span>
<a id=__codelineno-24-31 name=__codelineno-24-31 href=#__codelineno-24-31></a><span class=n>model_a</span><span class=o>.</span><span class=n>context</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>CovLoupe</span><span class=o>.</span><span class=n>context</span><span class=w>  </span><span class=c1># Switch to global context</span>
</code></pre></div> <p><strong>When to use per-model contexts:</strong> - Managing coverage for multiple projects in one script - Different error handling strategies per model - Separate log files for different data sources - Testing scenarios requiring isolated configurations</p> <p><strong>Simple use case (most common):</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=c1># For most use cases, just configure the global context once</span>
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=no>CovLoupe</span><span class=o>.</span><span class=n>error_handler</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>CovLoupe</span><span class=o>::</span><span class=no>ErrorHandlerFactory</span><span class=o>.</span><span class=n>for_library</span>
<a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=no>CovLoupe</span><span class=o>.</span><span class=n>default_log_file</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;coverage_analysis.log&#39;</span>
<a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a>
<a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=c1># All models automatically use the global context</span>
<a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=n>model</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>CovLoupe</span><span class=o>::</span><span class=no>CoverageModel</span><span class=o>.</span><span class=n>new</span>
</code></pre></div></p> <h2 id=staleness-detection>Staleness Detection<a class=headerlink href=#staleness-detection title="Permanent link">&para;</a></h2> <p>The <code>list</code> method returns a <code>'stale'</code> field for each file with one of these values:</p> <ul> <li><code>"ok"</code> - Coverage data is current</li> <li><code>"missing"</code> - <strong>Missing</strong>: File no longer exists on disk</li> <li><code>"newer"</code> - <strong>Timestamp</strong>: File modified more recently than coverage data</li> <li><code>"length_mismatch"</code> - <strong>Length</strong>: Source file line count differs from coverage data</li> <li><code>"error"</code> - <strong>Error</strong>: Staleness check failed</li> </ul> <p><strong>Note:</strong> Per-file methods (<code>summary_for</code>, <code>uncovered_for</code>, <code>detailed_for</code>, <code>raw_for</code>) do not include staleness information in their return values. To check staleness for individual files, use <code>list</code> and filter the results.</p> <p>When <code>raise_on_stale: true</code> is enabled in <code>CoverageModel.new</code>, the model will raise <code>CovLoupe::CoverageDataStaleError</code> exceptions when stale files are detected during method calls.</p> <h2 id=related-documentation>Related Documentation<a class=headerlink href=#related-documentation title="Permanent link">&para;</a></h2> <ul> <li><a href=../EXAMPLES/ >Examples</a> - Practical cookbook-style examples</li> <li><a href=../CLI_USAGE/ >CLI Usage</a> - Command-line interface reference</li> <li><a href=../ERROR_HANDLING/ >Error Handling</a> - Detailed error handling documentation</li> <li><a href=../MCP_INTEGRATION/ >MCP Integration</a> - AI assistant integration</li> </ul> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../MCP_INTEGRATION/ class="md-footer__link md-footer__link--prev" aria-label="Previous: MCP Integration"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> MCP Integration </div> </div> </a> <a href=../ADVANCED_USAGE/ class="md-footer__link md-footer__link--next" aria-label="Next: Advanced Usage"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Advanced Usage </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> </div> <div class=md-social> <a href=https://github.com/keithrbennett/cov-loupe target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://rubygems.org/gems/cov-loupe target=_blank rel=noopener title=rubygems.org class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M116.7 33.8c4.5-6.1 11.7-9.8 19.3-9.8h240c7.6 0 14.8 3.6 19.3 9.8l112 152c6.8 9.2 6.1 21.9-1.5 30.4l-232 256c-4.5 5-11 7.9-17.8 7.9s-13.2-2.9-17.8-7.9l-232-256c-7.7-8.5-8.3-21.2-1.5-30.4zm38.5 39.8c-3.3 2.5-4.2 7-2.1 10.5l57.4 95.7L63.3 192c-4.1.3-7.3 3.8-7.3 8s3.2 7.6 7.3 8l192 16h1.3l192-16c4.1-.3 7.3-3.8 7.3-8s-3.2-7.6-7.3-8l-147.2-12.3 57.4-95.6c2.1-3.5 1.2-8.1-2.1-10.5s-7.9-2-10.7 1l-90 97.6-90.1-97.6c-2.8-3-7.4-3.4-10.7-1"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["content.code.annotate", "content.code.copy", "content.tabs.link", "navigation.expand", "navigation.footer", "navigation.sections", "navigation.tabs", "navigation.top", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.79ae519e.min.js></script> </body> </html>