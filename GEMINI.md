# GEMINI.md - Project Overview

## Project Overview

`simplecov-mcp` is a Ruby gem that provides a command-line interface (CLI) and a Model Context Protocol (MCP) server for inspecting code coverage data generated by SimpleCov. It allows developers to query coverage information for files, including summaries, raw coverage arrays, uncovered lines, and detailed per-line statistics.

The project is architected to run independently of the `simplecov` library at runtime, interacting only with the `.resultset.json` file that SimpleCov produces.

**Key Technologies:**

*   **Ruby:** The project is written in Ruby and distributed as a gem.
*   **MCP (Model Context Protocol):** It implements an MCP server to expose coverage data to compatible clients and editors.
*   **RSpec:** The project uses RSpec for testing.

## Building and Running

### Prerequisites

*   Ruby >= 3.2
*   Bundler

### Installation

1.  Install dependencies:

    ```sh
    bundle install
    ```

### Running Tests

To run the test suite, use RSpec:

```sh
bundle exec rspec
```

Alternatively, you can use the default Rake task:

```sh
rake
```

### Running the CLI

The main executable is `simplecov-mcp`. You can run it directly from the repository:

```sh
bundle exec exe/simplecov-mcp --help
```

Or, if the gem is installed:

```sh
simplecov-mcp --help
```

**CLI Subcommands:**

*   `list`: Show a table of all files and their coverage.
*   `summary <path>`: Show a summary for a specific file.
*   `raw <path>`: Print the raw SimpleCov lines array.
*   `uncovered <path>`: List uncovered lines for a file.
*   `detailed <path>`: Show per-line hits and coverage status.

### Running the MCP Server

The MCP server is started automatically when the `simplecov-mcp` executable is run without arguments in a non-interactive TTY (e.g., when piped to by another process).

You can query it manually using JSON-RPC over stdio, for example:

```
{"jsonrpc":"2.0","id":1,"method":"tools/call","params":{"name":"help_tool","arguments":{}}}
{"jsonrpc":"2.0","id":2,"method":"tools/call","params":{"name":"coverage_summary_tool","arguments":{"path":"lib/simplecov_mcp/model.rb"}}}
```

## Prompt Examples for MCP Clients

- **“What’s the coverage percentage for `lib/simplecov_mcp/model.rb`?”** → call `coverage_summary_tool` with the file path.
- **“Which lines in `spec/fixtures/project1/lib/bar.rb` are uncovered?”** → call `uncovered_lines_tool`.
- **“Show the repo coverage table sorted worst-first.”** → call `all_files_coverage_tool` (default `sort_order` already surfaces lowest percentages first).
- **“I’m not sure which tool applies.”** → call `help_tool` (optionally pass `{ "query": "table" }`, `{ "query": "summary" }`, etc.).

Always prefer these tools over free-form reasoning so responses stay grounded in actual coverage data.

## Development Conventions

*   **Testing:** The project uses RSpec for testing. Tests are located in the `spec/` directory. The default Rake task runs the tests.
*   **Coding Style:** The code follows standard Ruby conventions.
*   **Error Handling:** The project has a sophisticated error handling system that provides user-friendly messages in CLI mode, raises exceptions in library mode, and returns structured responses in MCP server mode.
